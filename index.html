<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atividade de Biologia - 3º Bimestre</title>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: silver; padding: 20px; color: #333;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    header {
      background: linear-gradient(to right, #0066cc, #000033);
      color: white; padding: 15px; border-radius: 10px;
      margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.3), 
      0 0 15px rgba(255,255,255,0.5) inset;
    }
    .school-name { text-align: center; font-size: 1.8em; font-weight: bold; margin-bottom: 15px; }
    .activity-title { text-align: center; font-size: 1.4em; margin-bottom: 15px; }
    
    .student-info {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, auto));
      gap: 10px; align-items: end;
    }
    .info-group label { font-weight: bold; margin-bottom: 4px; display: block; font-size: 0.9em; }
    .info-group select, .info-group input {
      padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px;
      width: auto; min-width: 160px; max-width: 100%;
    }

    .question {
      background: linear-gradient(to right, #0066cc, #000033);
      color: white; padding: 20px; border-radius: 10px;
      margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.3),
      0 0 15px rgba(255,255,255,0.5) inset;
    }
    .question-number { font-weight: bold; margin-bottom: 10px; font-size: 1.1em; }
    .question-text { margin-bottom: 12px; line-height: 1.5; }

    .alternatives { display: grid; gap: 8px; }
    .alternative {
      background: rgba(255,255,255,0.2); padding: 8px 12px;
      border-radius: 5px; display: flex; align-items: center;
      cursor: pointer; transition: background 0.3s;
      width: fit-content; max-width: 100%;
    }
    .alternative:hover { background: rgba(255,255,255,0.35); }
    .alternative-letter { font-weight: bold; margin-right: 6px; }
    .alternative input { margin-right: 8px; }
    .alternative-text { white-space: normal; }

    .buttons {
      display: flex; justify-content: center; gap: 20px; margin-top: 20px;
    }
    button {
      padding: 10px 20px; border: none; border-radius: 5px;
      background: linear-gradient(to bottom, #0066cc, #004499);
      color: white; cursor: pointer; font-weight: bold; transition: all .3s;
    }
    button:hover {
      background: linear-gradient(to bottom, #004499, #002266);
      transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .results {
      display: none; background: linear-gradient(to right, #0066cc, #000033);
      color: white; padding: 20px; border-radius: 10px;
      margin-top: 20px; text-align: center;
    }
    .score { font-size: 1.4em; margin-bottom: 12px; }
    .feedback { text-align: left; margin-top: 10px; }
    .feedback-item {
      margin-bottom: 8px; padding: 8px; border-radius: 5px;
      background: rgba(255,255,255,0.15);
    }
    .loading { display: none; text-align: center; margin-top: 20px; }
    .loading-spinner {
      border: 4px solid rgba(255,255,255,0.3); border-radius: 50%;
      border-top: 4px solid #0066cc; width: 30px; height: 30px;
      animation: spin 1s linear infinite; margin: 0 auto 8px;
    }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="school-name">E.E. LYDIAKITZ MOREIRA</div>
      <div class="activity-title">ATIVIDADE DE BIOLOGIA (3º BIMESTRE)<br>REVISÃO DOS TEMAS</div>
      
      <div class="student-info">
        <div class="info-group">
          <label for="student-name">NOME:</label>
          <select id="student-name">
            <option value="">Selecione seu nome</option>
          </select>
        </div>
        <div class="info-group">
          <label for="student-number">Nº:</label>
          <input type="text" id="student-number" readonly>
        </div>
        <div class="info-group">
          <label for="student-class">SÉRIE:</label>
          <input type="text" id="student-class" readonly>
        </div>
        <div class="info-group">
          <label for="activity-date">DATA:</label>
          <input type="text" id="activity-date" readonly>
        </div>
        <div class="info-group">
          <label for="student-email">E-mail institucional:</label>
          <input type="text" id="student-email" readonly>
        </div>
      </div>
    </header>

    <div id="questions-container"></div>

    <div class="buttons">
      <button id="submit-btn">Enviar Respostas</button>
      <button id="reset-btn">Limpar Tudo</button>
    </div>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>Enviando respostas para o Google Sheets...</p>
    </div>

    <div id="results" class="results">
      <div class="score">Sua pontuação: <span id="score-value">0</span>/10</div>
      <div>Obrigado por participar! Suas respostas foram registradas.</div>
      <div class="feedback" id="feedback"></div>
    </div>
  </div>

  <script>
    const students = [
        // Dados dos alunos
        const students = [
            {number: 1, name: "ALEXANDRE BATISTA DOS SANTOS", email: "00001141439785SP@al.educacao.sp.gov.br"},
            {number: 5, name: "ANA LÍVIA BRAGA DOS SANTOS", email: "00001122248246SP@al.educacao.sp.gov.br"},
            {number: 7, name: "ARTHUR CASTRO SILVA", email: "00001122238228SP@al.educacao.sp.gov.br"},
            {number: 11, name: "DANIELLE OLIVEIRA DA SILVA NUNES", email: "00001122096756SP@al.educacao.sp.gov.br"},
            {number: 14, name: "ELOYSA ANDRADE OLIVEIRA SILVA", email: "00001103565242SP@al.educacao.sp.gov.br"},
            {number: 18, name: "FELIPE MARCONDES SILVA", email: "0000112225538XSP@al.educacao.sp.gov.br"},
            {number: 19, name: "GEOVANA FERREIRA DA SILVA SOUZA", email: "00001111268939SP@al.educacao.sp.gov.br"},
            {number: 20, name: "GEOVANNA GABRIELA PIERRE SILVA", email: "00001122198954SP@al.educacao.sp.gov.br"},
            {number: 24, name: "ISAAK ALVAREZ MARQUEZ CAETANO", email: "00001141664471SP@al.educacao.sp.gov.br"},
            {number: 30, name: "KAMILA NEVES BRITO", email: "00001122109829SP@al.educacao.sp.gov.br"},
            {number: 33, name: "KEMILLY VITORIA RODRIGUES MARIANO", email: "00001122119781SP@al.educacao.sp.gov.br"},
            {number: 34, name: "LAURA LUIZA DOS SANTOS ALMEIDA", email: "00001141686442SP@al.educacao.sp.gov.br"},
            {number: 37, name: "MARIA EDUARDA VENCESLAU DE SOUZA", email: "00001123918867SP@al.educacao.sp.gov.br"},
            {number: 38, name: "MATHEUS CAVALCANTE LISBOA", email: "00001122175759SP@al.educacao.sp.gov.br"},
            {number: 40, name: "MURILLO SOUZA RODRIGUES DOS SANTOS", email: "00001122296228SP@al.educacao.sp.gov.br"},
            {number: 45, name: "PEDRO HENRIQUE MAURICIO DA SILVA CHAGAS", email: "00001140937571SP@al.educacao.sp.gov.br"},
            {number: 48, name: "RHUAN LIMA OLIVEIRA", email: "00001122272169SP@al.educacao.sp.gov.br"},
            {number: 49, name: "THAINA FIDELIS XAVIER DA SILVA", email: "00001122229148SP@al.educacao.sp.gov.br"},
            {number: 54, name: "DENIS CASTRO DURVALDO", email: "00001132474152SP@al.educacao.sp.gov.br"},
            {number: 56, name: "ISAAC LEMOS SANTOS", email: "00001141548744SP@al.educacao.sp.gov.br"},
            {number: 57, name: "EMILLY EDUARDA BONIFACIO DE AMORIM CORREA", email: "00001141568111SP@al.educacao.sp.gov.br"},
            {number: 58, name: "RAYSSA GUBEREV FRAGA", email: "00001114029373SP@al.educacao.sp.gov.br"},
            {number: 59, name: "LEONARDO ABADE DA SILVA DANTAS", email: "0000114154104XSP@al.educacao.sp.gov.br"},
            {number: 61, name: "MILLENA CRISTINA LOPES DE CARVALHO", email: "00001122201436SP@al.educacao.sp.gov.br"},
            {number: 62, name: "PYETRA GOMES MARTINS", email: "00001141681717SP@al.educacao.sp.gov.br"},
            {number: 63, name: "MIRELLA BRITO DA SILVA", email: "00001122266224SP@al.educacao.sp.gov.br"},
            {number: 64, name: "CARLOS EDUARDO MARTINS DA SILVA", email: "00001141492003SP@al.educacao.sp.gov.br"},
            {number: 66, name: "STELLA MARTINS DA SILVA", email: "0000112231937XSP@al.educacao.sp.gov.br"},
            {number: 67, name: "DYESSICA MAYARA DOS SANTOS GOMES", email: "00001141700888SP@al.educacao.sp.gov.br"},
            {number: 68, name: "LARISSA DE LOURDES DOS SANTOS", email: "00001122136869SP@al.educacao.sp.gov.br"},
            {number: 70, name: "GUSTAVO RODRIGUES DE SOUZA", email: "00001132106084SP@al.educacao.sp.gov.br"},
            {number: 72, name: "NAYARA BARROS DE MORAIS", email: "00001141532232SP@al.educacao.sp.gov.br"},
            {number: 73, name: "VITÓRIA SANTOS TEIXEIRA", email: "00001111267923SP@al.educacao.sp.gov.br"},
            {number: 74, name: "BRUNA VITORIA DA MOTA OLIVEIRA", email: "00001104893149SP@al.educacao.sp.gov.br"},
            {number: 75, name: "JOÃO PAULO RODRIGUES DE SOUZA FILHO", email: "00001122178013SP@al.educacao.sp.gov.br"},
            {number: 76, name: "MARIA EDUARDA DE OLIVEIRA RODRIGUES", email: "00001122177574SP@al.educacao.sp.gov.br"},
            {number: 77, name: "LUIZ HENRIQUE JESUS DOS SANTOS FABRICIO", email: "00001101285746SP@al.educacao.sp.gov.br"},
            {number: 78, name: "EDUARDO CARRASCOSA PINTOR", email: "00001132133828SP@al.educacao.sp.gov.br"},
            {number: 79, name: "GUILHERME DANIEL VELOSO DOS SANTOS", email: "00001132176281SP@al.educacao.sp.gov.br"},
            {number: 80, name: "JOAO GABRIEL AMORIM TOBIAS", email: "00001141428611SP@al.educacao.sp.gov.br"},
            {number: 81, name: "RIAN SANTOS MACHADO", email: "00001132118074SP@al.educacao.sp.gov.br"},
            {number: 82, name: "JULIA ARAUJO DE LIMA", email: "00001101366886SP@al.educacao.sp.gov.br"},
            {number: 83, name: "BRENDA ROSA DA SILVA", email: "00001122135452SP@al.educacao.sp.gov.br"},
            {number: 84, name: "CAMILA APPOLINÁRIO", email: "00001122096380SP@al.educacao.sp.gov.br"}
        ];


    const questions = [
      {
      // Banco de questões (10 para exemplo)
        const questions = [
            {
                id: 1,
                question: "No Jogo dos Quatis, os estudantes simularam a variação populacional de quatis ao longo de gerações, considerando eventos ambiental. Na 3ª geração, calor e chuva prolongadas aumentaram a população de sapos, que se alimentam de insetos frugívoros. Considerando que os quatis se alimentam de sapos e insetos, qual foi o impacto na população de quatis e por quê?",
                alternatives: [
                    "Aumento de 1 indivíduo, porque houve aumento na disponibilidade de alimento para os quatis.",
                    "Diminuição de 1 indivíduo, porque os sapos competem com os quatis pelos insetos.",
                    "Aumento de 6 indivíduos, porque a chuva favoreceu a reprodução dos quatis.",
                    "Diminuição de 3 indivíduos, porque a chuva causou inundações.",
                    "Não houve alteração, porque o evento não afetou diretamente os quatis."
                ],
                correct: 0,
                feedback: "O aumento na população de sapos representa mais alimento disponível para os quatis, que são onívoros e se alimentam tanto de sapos quanto de insetos. Por isso, a população de quatis aumentou em 1 indivíduo."
            },
            {
                id: 2,
                question: "Os ciclos do carbono, oxigênio e água estão integrados em processos biológicos. Durante a fotossíntese, qual é a participação de cada ciclo?",
                alternatives: [
                    "Ciclo da água: a água é utilizada como fonte de elétrons e hidrogênio; Ciclo do oxigênio: o oxigênio é liberado; Ciclo do carbono: o dióxido de carbono é absorvido e convertido em glicose.",
                    "Ciclo da água: a água é produzida; Ciclo do oxigênio: o oxigênio é consumido; Ciclo do carbono: o carbono é liberado na forma de CO₂.",
                    "Ciclo da água: a água é decomposta em hidrogênio e oxigênio; Ciclo do oxigênio: o oxigênio é fixado; Ciclo do carbono: o carbono é transformado em metano.",
                    "Ciclo da água: a água é transpirada; Ciclo do oxigênio: o oxigênio é utilizado na respiração; Ciclo do carbono: o carbono é fixado por bactérias.",
                    "Ciclo da água: a água é absorvida pelas raízes; Ciclo do oxigênio: o oxigênio é liberado na respiração; Ciclo do carbono: o carbono é liberado na decomposição."
                ],
                correct: 0,
                feedback: "Na fotossíntese, a água é utilizada como fonte de elétrons e hidrogênio, o oxigênio é liberado como subproduto, e o dióxido de carbono é absorvido e convertido em glicose, integrando os três ciclos biogeoquímicos."
            },
            {
                id: 3,
                question: "Um agricultor utilizou fertilizantes nitrogenados inorgânicos em sua lavoura. Após algumas safras, o solo ficou mais ácido e rios próximos apresentaram proliferação de algas. Qual é a explicação para esses fenômenos?",
                alternatives: [
                    "Os fertilizantes inorgânicos aumentam a taxa de desnitrificação, liberando N₂ para a atmosfera.",
                    "O excesso de nitrogênio no solo é lixiviado para corpos d'água, causando eutrofização.",
                    "Os fertilizantes orgânicos serían mais adequados porque não alteram o pH do suelo.",
                    "A amonificação realizada por bactérias é inibida por fertilizantes inorgânicos.",
                    "O nitrogênio inorgânico não é absorvido pelas plantas, acumulando-se no solo."
                ],
                correct: 1,
                feedback: "O excesso de fertilizantes nitrogenados pode ser lixiviado para corpos d'água, causando eutrofização. Este processo promove o crescimento excessivo de algas, que ao serem decompostas, consomem oxigênio, podendo levar à morte de organismos aquáticos."
            },
            {
                id: 4,
                question: "Em uma plenária sobre o uso de fertilizantes, um grupo defendeu os fertilizantes orgânicos e outro os inorgânicos. Quais são as vantagens dos fertilizantes orgânicos em relação aos inorgânicos?",
                alternatives: [
                    "Liberação imediata de nutrientes e alta concentração de nitrogênio.",
                    "Melhoria da estrutura do solo, liberação gradual de nutrientes e promoção da atividade microbiana.",
                    "Não alteram o pH do solo e são mais baratos.",
                    "São mais eficientes na fixação biológica de nitrogênio.",
                    "Não causam eutrofização em corpos d'água, mesmo quando usados em excesso."
                ],
                correct: 1,
                feedback: "Fertilizantes orgânicos melhoram a estrutura do solo, liberam nutrientes gradualmente e promovem a atividade microbiana benéfica, diferentemente dos fertilizantes inorgânicos que podem causar acidificação do solo e poluição hídrica."
            },
            {
                id: 5,
                question: "Dois lagos foram monitorados quanto a parâmetros de qualidade de água. O Lago A apresentou: nitrogênio (0,5 mg/L), fósforo (0,03 mg/L), oxigênio dissolvido (8,0 mg/L), biomassa de algas (5,0 mg/m³). O Lago B apresentou: nitrogênio (5,0 mg/L), fósforo (0,5 mg/L), oxigênio dissolvido (2,0 mg/L), biomassa de algas (150,0 mg/m³). Qual lago está eutrofizado e qual a principal causa da redução de oxigênio dissolvido?",
                alternatives: [
                    "Lago A - devido à alta taxa de fotossíntese.",
                    "Lago B - devido à decomposição de matéria orgânica por bactérias aeróbicas.",
                    "Lago A - devido ao excesso de nutrientes.",
                    "Lago B - devido à baixa incidência de luz.",
                    "Lago A - devido à alta taxa de respiração das algas."
                ],
                correct: 1,
                feedback: "O Lago B apresenta sinais de eutrofização com altos níveis de nutrientes (fósforo e nitrogênio) e alta biomassa de algas. A redução do oxigênio dissolvido ocorre devido ao consumo por bactérias aeróbicas durante a decomposição da matéria orgânica resultante da floração algal."
            },
            {
                id: 6,
                question: "Em 2024, a Baixada Santista teve a venda de moluscos suspensa devido à contaminação por toxinas de microalgas. Esse fenômeno, conhecido como maré vermelha, foi atribuído ao despejo de esgoto e ao aquecimento global. Qual é um impacto econômico direto desse evento?",
                alternatives: [
                    "Aumento do turismo na região.",
                    "Redução da pesca e do comércio de frutos do mar.",
                    "Diminuição da salinidade da água do mar.",
                    "Aumento da biodiversidade marinha.",
                    "Intensificação da fotossíntese fitoplanctônica."
                ],
                correct: 1,
                feedback: "A maré vermelha causa contaminação de frutos do mar por toxinas, levando à suspensão da pesca e comercialização desses produtos. Isso resulta em impacts econômicos diretos para pescadores e comerciantes da região afetada."
            },
            {
                id: 7,
                question: "Em uma cadeia alimentar representada por goiabeira → quatis → onças, os dados de energia foram: goiabeira (1000 kcal), quatis (500 kcal), onças (200 kcal). Qual pirâmide de energia melhor representa essa situação?",
                alternatives: [
                    "Pirâmide invertida, porque a energia aumenta a cada nível trófico.",
                    "Pirâmide ereta com base larga, porque a energia diminui a cada nível trófico.",
                    "Pirâmide de números, porque o número de indivíduos diminui.",
                    "Pirâmide de biomassa invertida, porque a biomassa dos produtores é menor.",
                    "Não é possível construir uma pirâmide de energia com esses dados."
                ],
                correct: 1,
                feedback: "A pirâmide de energia é sempre ereta, pois a energia diminui a cada nível trófico (cerca de 90% é perdida) devido a processos metabólicos, como respiração, e perda de calor. Esta é uma das leis da termodinâmica aplicada aos ecossistemas."
            },
            {
                id: 8,
                question: "Como o nitrogênio, originalmente fixado por bactérias no solo, chega até um animal carnívoro, como uma onça?",
                alternatives: [
                    "Diretamente pela absorção de nitrato do solo pela onça.",
                    "Pela cadeia alimentar: plantas absorvem nitrato, herbívoros comem plantas, carnívoros comem herbívoros.",
                    "Pela respiração, absorvendo nitrogênio atmosférico.",
                    "Pela desnitrificação, que libera nitrogênio gasoso para a atmosfera.",
                    "Pela amonificação, que transforma nitrogênio orgânico em amônia."
                ],
                correct: 1,
                feedback: "O nitrogênio fixado por bactérias é absorvido pelas plantas na forma de nitratos, transformado em compostos orgânicos, e transferido através da cadeia alimentar para herbívoros e depois para carnívoros como a onça."
            },
            {
                id: 9,
                question: "A rotação de culturas com leguminosas é uma prática agrícola que visa a sustentabilidade. Por que as leguminosas são escolhidas para essa prática?",
                alternatives: [
                    "Porque elas não necessitam de nitrogênio para crescer.",
                    "Porque elas possuem bactérias em suas raízes que fixam nitrogênio atmosférico, enriquecendo o solo.",
                    "Porque elas absorvem nitrogênio do ar através das folhas.",
                    "Porque elas liberam oxigênio durante a fotossíntese, melhorando a qualidade do ar.",
                    "Porque elas têm raízes profundas que impedem a lixiviação."
                ],
                correct: 1,
                feedback: "As leguminosas estabelecem simbiose com bactérias do gênero Rhizobium, que fixam nitrogênio atmosférico, convertendo-o em formas assimiláveis pelas plantas e enriquecendo o solo com compostos nitrogenados."
            },
            {
                id: 10,
                question: "Em um lago eutrofizado, observa-se que os peixes nadam próximos à superfície. Qual a explicação para esse comportamento?",
                alternatives: [
                    "Proliferação de microrganismos patogênicos, o que promove sua fuga para a superfície.",
                    "Aumento da quantidade de nutrientes, o que facilita a sua alimentação.",
                    "Elevação da densidade da água, o que dificulta o deslocamento vertical.",
                    "Restrição de oxigênio, o que os obriga a buscar o gás na interface água-ar.",
                    "Redução da luminosidade, o que os impede de enxergar."
                ],
                correct: 3,
                feedback: "Na eutrofização, a decomposição da matéria orgânica consome oxigênio dissolvido na água, criando zonas anóxicas. Os peixes nadam próximo à superfície para acessar oxigênio atmosférico na interface água-ar."
            }
        ];



    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxfQZqBIhFhIVqho2vpreBaYEgL43Hka2E9-5qiPiAiy_seEXNeDaKe5Z8xrkgrTJ60/exec";

    let selectedQuestions = [];
    let studentAnswers = {};
    let currentStudent = null;

    function initActivity() {
      document.getElementById('activity-date').value = new Date().toLocaleDateString('pt-BR');
      const studentSelect = document.getElementById('student-name');
      students.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.number; opt.textContent = s.name;
        studentSelect.appendChild(opt);
      });
      selectedQuestions = getRandomQuestions(questions, 10);
      displayQuestions(selectedQuestions);
      document.getElementById('student-name').addEventListener('change', handleStudentSelection);
      document.getElementById('submit-btn').addEventListener('click', handleSubmit);
      document.getElementById('reset-btn').addEventListener('click', () => location.reload());
    }

    function getRandomQuestions(arr, count) {
      return [...arr].sort(() => Math.random() - 0.5).slice(0, count);
    }

    function displayQuestions(qs) {
      const container = document.getElementById('questions-container');
      container.innerHTML = "";
      qs.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = "question";
        div.innerHTML = `
          <div class="question-number">Questão ${i+1}:</div>
          <div class="question-text">${q.question}</div>
          <div class="alternatives">
            ${q.alternatives.map((alt, j) => `
              <label class="alternative">
                <span class="alternative-letter">${String.fromCharCode(65+j)})</span>
                <input type="radio" name="q-${q.id}" value="${j}">
                <span class="alternative-text">${alt}</span>
              </label>
            `).join('')}
          </div>
        `;
        container.appendChild(div);
      });
    }

    function handleStudentSelection(e) {
      const student = students.find(s => s.number == e.target.value);
      if (student) {
        currentStudent = student;
        document.getElementById('student-number').value = student.number;
        document.getElementById('student-class').value = "1ª Série";
        document.getElementById('student-email').value = student.email;
      }
    }

    async function handleSubmit() {
      if (!currentStudent) { alert("Selecione seu nome."); return; }
      studentAnswers = {};
      let allAnswered = true;
      selectedQuestions.forEach(q => {
        const selected = document.querySelector(`input[name="q-${q.id}"]:checked`);
        if (selected) studentAnswers[q.id] = parseInt(selected.value);
        else allAnswered = false;
      });
      if (!allAnswered) { alert("Responda todas as questões."); return; }
      const score = calculateScore(selectedQuestions, studentAnswers);
      document.getElementById('loading').style.display = 'block';
      try {
        await sendDataToGoogleSheets(score);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('score-value').textContent = score;
        document.getElementById('results').style.display = 'block';
        generateFeedback(selectedQuestions, studentAnswers);
        document.getElementById('results').scrollIntoView({behavior:"smooth"});
      } catch (err) {
        console.error(err);
        document.getElementById('loading').style.display = 'none';
        alert("Erro ao enviar respostas. Por favor, tente novamente.");
      }
    }

    function calculateScore(qs, answers) {
      return qs.reduce((acc, q) => acc + (answers[q.id] === q.correct ? 1 : 0), 0);
    }

    function generateFeedback(qs, answers) {
      const fb = document.getElementById('feedback');
      fb.innerHTML = "";
      qs.forEach((q, i) => {
        if (answers[q.id] !== q.correct) {
          const div = document.createElement('div');
          div.className = "feedback-item";
          div.innerHTML = `<strong>Questão ${i+1}:</strong> ${q.feedback}`;
          fb.appendChild(div);
        }
      });
      if (!fb.innerHTML) fb.innerHTML = `<div class="feedback-item">Parabéns! Você acertou tudo!</div>`;
    }

    async function sendDataToGoogleSheets(score) {
      const payload = {
        student: currentStudent,
        answers: studentAnswers,
        score: score,
        date: new Date().toLocaleString("pt-BR")
      };
      const res = await fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      });
      return res;
    }

    window.onload = initActivity;
  </script>
</body>
</html>

