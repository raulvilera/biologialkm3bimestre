<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atividade de Biologia – 3º Bimestre</title>
  <style>
    /* CSS Custom Properties (Variáveis CSS) */
    :root {
      --bg-primary: #f7f7fb;
      --bg-card: #ffffff;
      --text-primary: #1f2937;
      --text-muted: #6b7280;
      --color-brand: #2563eb;
      --color-accent: #10b981;
      --color-danger: #ef4444;
      --color-success: #065f46;
      --shadow-default: 0 10px 30px rgba(0, 0, 0, 0.08);
      --border-radius: 14px;
      --border-radius-small: 8px;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 16px;
      --spacing-xl: 24px;
      --font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, Helvetica, Arial, sans-serif;
      --font-family-mono: ui-monospace, 'SFMono-Regular', Menlo, Consolas, monospace;
    }

    /* Reset e configurações base */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-primary);
      color: var(--text-primary);
      margin: 0;
      line-height: 1.6;
    }

    /* Header com gradiente */
    .header {
      background: linear-gradient(90deg, #add8e6, #90ee90);
      padding: var(--spacing-xl);
      box-shadow: var(--shadow-default);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header__top {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--spacing-md);
      justify-content: space-between;
    }

    .header__school {
      font-weight: 800;
      font-size: 1.125rem;
    }

    .header__student {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .header__student small {
      color: var(--text-muted);
    }

    .header__title {
      font-weight: 800;
      text-align: center;
      margin-top: var(--spacing-md);
      font-size: 1.25rem;
    }

    /* Formulário */
    .form-group {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .form-control {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid #d1d5db;
      border-radius: var(--border-radius-small);
      font-size: 0.875rem;
    }

    .form-control--number {
      width: 90px;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--color-brand);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* Main content */
    .main {
      max-width: 980px;
      margin: 28px auto;
      padding: 0 var(--spacing-lg);
    }

    /* Cards das questões */
    .question-card {
      background: #2f2f2f;
      color: #ffffff;
      font-weight: bold;
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-xl);
      padding: 18px;
      position: relative;
      box-shadow: inset 0 -4px 6px rgba(255, 255, 255, 0.4);
      transition: opacity 0.3s ease;
    }

    .question-card--locked {
      opacity: 0.75;
    }

    .question-card::before {
      content: "";
      display: block;
      height: 4mm;
      width: 100%;
      background: #ffffff;
      margin: var(--spacing-md) 0;
      border-radius: 2px;
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--spacing-md);
    }

    .question-number {
      color: #ef4444;
      font-weight: bold;
      font-size: 1rem;
    }

    .question-timer {
      font-family: var(--font-family-mono);
      color: #dddddd;
      font-size: 0.75rem;
      background: #444444;
      border-radius: var(--border-radius-small);
      padding: var(--spacing-xs) var(--spacing-sm);
    }

    .question-statement {
      margin: 6px 0 10px 0;
      line-height: 1.5;
    }

    .alternatives {
      display: grid;
      gap: 10px;
    }

    .alternative {
      background: #3a3a3a;
      border: 1px solid #555555;
      border-radius: var(--border-radius-small);
      padding: 10px;
      cursor: pointer;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      transition: background-color 0.2s ease;
    }

    .alternative:hover {
      background: #444444;
    }

    .alternative input[type="radio"] {
      margin-top: 3px;
    }

    /* Footer e controles */
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md) 0;
      flex-wrap: wrap;
    }

    .footer__info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      flex-wrap: wrap;
    }

    .button {
      background: var(--color-brand);
      color: #ffffff;
      border: none;
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.2s ease, opacity 0.2s ease;
    }

    .button:hover:not(:disabled) {
      background: #1d4ed8;
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Badges e status */
    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      color: var(--color-success);
      background: #d1fae5;
    }

    .note {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .status--success {
      color: var(--color-success);
    }

    .status--error {
      color: var(--color-danger);
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .header__top {
        flex-direction: column;
        align-items: stretch;
      }

      .header__student {
        justify-content: center;
      }

      .footer {
        flex-direction: column;
        align-items: stretch;
      }

      .footer__info {
        justify-content: center;
      }

      .question-header {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
    }

    /* Melhorias de acessibilidade */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Estados de foco melhorados */
    .alternative:focus-within {
      outline: 2px solid var(--color-brand);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header__top">
      <div class="header__school">E.E. LYDIA KITZ MOREIRA</div>
      <div class="header__student">
        <div class="form-group">
          <label for="student">NOME:</label>
          <select id="student" class="form-control" aria-label="Selecione seu nome">
            <option value="">— selecione —</option>
          </select>
        </div>
        <div class="form-group">
          <small>Nº</small>
          <input 
            id="numero" 
            class="form-control form-control--number" 
            type="text" 
            placeholder="—" 
            readonly 
            aria-label="Número do aluno"
          >
        </div>
      </div>
    </div>
    <div class="header__title">
      <strong>ATIVIDADE DE BIOLOGIA (3º BIMESTRE)</strong>
    </div>
  </header>

  <main class="main">
    <div class="note">
      Serão exibidas 10 questões (2 de cada aula). A ordem das questões e das alternativas muda a cada acesso, mantendo o mesmo gabarito por questão.
    </div>
    
    <div id="quiz" role="main" aria-label="Questões do quiz"></div>
    
    <div class="question-card">
      <div class="footer">
        <div class="footer__info">
          <span id="progress" class="badge">0/10 respondidas</span>
          <span id="status" class="note" aria-live="polite"></span>
        </div>
        <button id="send" class="button" disabled>Enviar respostas</button>
      </div>
      <div class="note">
        As respostas serão registradas na planilha Google Sheets (aba "1ºH").
      </div>
    </div>
  </main>

  <script>
    /**
     * ⚠️ IMPORTANTE – Integração com Google Sheets
     * Para gravar as respostas, publique um Google Apps Script como Web App e cole a URL no const SCRIPT_URL abaixo.
     * 
     * 1) No Google Drive > Novo > Apps Script.
     * 2) Cole o código do GAS abaixo e substitua o ID pela sua planilha.
     * 3) Implante como Aplicativo da Web (qualquer pessoa com o link) e copie a URL de implantação.
     * 4) Retorne aqui e defina const SCRIPT_URL = 'URL_DA_IMPLANTAÇÃO';
     *
     * // == Código Google Apps Script (GAS) ==
     * const SHEET_ID = '1yGahAlt7tnGbqhv5auMQyNqpIoPg7bYQI34EdGWXUbo';
     * const ABA = '1ºH';
     * 
     * function doPost(e) {
     *   try {
     *     const ss = SpreadsheetApp.openById(SHEET_ID);
     *     const sh = ss.getSheetByName(ABA);
     *     const body = JSON.parse(e.postData.contents);
     *     
     *     // Próxima linha vazia a partir de H4
     *     const startRow = 4; // H4
     *     const col = 8; // coluna H
     *     let row = startRow;
     *     while(sh.getRange(row, col).getValue() !== '') row++;
     *     
     *     // Grava um JSON compactado com tudo: cabeçalho, respostas, tempos e carimbo de data/hora
     *     const payload = JSON.stringify({
     *       carimbo: new Date().toISOString(),
     *       aluno: body.aluno,
     *       numero: body.numero,
     *       respostas: body.respostas,
     *       tempos: body.tempos,
     *       ordemQuestoes: body.ordemQuestoes
     *     });
     *     
     *     sh.getRange(row, col).setValue(payload);
     *     return ContentService.createTextOutput(JSON.stringify({ok: true, row}))
     *       .setMimeType(ContentService.MimeType.JSON);
     *   } catch(err) {
     *     return ContentService.createTextOutput(JSON.stringify({ok: false, erro: String(err)}))
     *       .setMimeType(ContentService.MimeType.JSON);
     *   }
     * }
     * // ======================================
     */

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxA8-hm8y_rL0A42ZjXEDb3y9votwqIqO9wSiz-5p5Yfi5d50jMzK_gd6-MK4MY1S6Q/exec'; // <-- SUBSTITUA após publicar o GAS

    // Lista de alunos (número -> nome) – será usada para autopreencher o Nº
    const alunos = [
      [1, 'ALEXANDRE BATISTA DOS SANTOS'],
      [5, 'ANA LÍVIA BRAGA DOS SANTOS'],
      [7, 'ARTHUR CASTRO SILVA'],
      [11, 'DANIELLE OLIVEIRA DA SILVA NUNES'],
      [14, 'ELOYSA ANDRADE OLIVEIRA SILVA'],
      [18, 'FELIPE MARCONDES SILVA'],
      [19, 'GEOVANA FERREIRA DA SILVA SOUZA'],
      [20, 'GEOVANNA GABRIELA PIERRE SILVA'],
      [24, 'ISAAK ALVAREZ MARQUEZ CAETANO'],
      [30, 'KAMILA NEVES BRITO'],
      [33, 'KEMILLY VITORIA RODRIGUES MARIANO'],
      [34, 'LAURA LUIZA DOS SANTOS ALMEIDA'],
      [37, 'MARIA EDUARDA VENCESLAU DE SOUZA'],
      [38, 'MATHEUS CAVALCANTE LISBOA'],
      [40, 'MURILLO SOUZA RODRIGUES DOS SANTOS'],
      [45, 'PEDRO HENRIQUE MAURICIO DA SILVA CHAGAS'],
      [48, 'RHUAN LIMA OLIVEIRA'],
      [49, 'THAINA FIDELIS XAVIER DA SILVA'],
      [54, 'DENIS CASTRO DURVALDO'],
      [56, 'ISAAC LEMOS SANTOS'],
      [57, 'EMILLY EDUARDA BONIFACIO DE AMORIM CORREA'],
      [58, 'RAYSSA GUBEREV FRAGA'],
      [59, 'LEONARDO ABADE DA SILVA DANTAS'],
      [61, 'MILENA CRISTINA LOPES DE CARVALHO'],
      [62, 'PYETRA GOMES MARTINS'],
      [63, 'MIRELLA BRITO DA SILVA'],
      [64, 'CARLOS EDUARDO MARTINS DA SILVA'],
      [66, 'STELLA MARTINS DA SILVA'],
      [67, 'DYESSICA MAYARA DOS SANTOS GOMES'],
      [68, 'LARISSA DE LOURDES DOS SANTOS'],
      [69, 'DAVI AMERICO FEITOSA'],
      [70, 'GUSTAVO RODRIGUES DE SOUZA'],
      [71, 'PAULO HENRIQUE SOUZA MARTELO'],
      [72, 'NAYARA BARROS DE MORAIS'],
      [73, 'VITÓRIA SANTOS TEIXEIRA'],
      [74, 'BRUNA VITORIA DA MOTA OLIVEIRA'],
      [75, 'JOÃO PAULO RODRIGUES DE SOUZA FILHO'],
      [76, 'MARIA EDUARDA DE OLIVEIRA RODRIGUES'],
      [77, 'LUIZ HENRIQUE JESUS DOS SANTOS FABRICIO'],
      [78, 'EDUARDO CARRASCOSA PINTOR'],
      [79, 'GUILHERME DANIEL VELOSO DOS SANTOS'],
      [80, 'JOAO GABRIEL AMORIM TOBIAS'],
      [81, 'RIAN SANTOS MACHADO'],
      [82, 'JULIA ARAUJO DE LIMA'],
    ];

    // ======= Banco de Questões =======
    // Estrutura: {id, aula:1|2|3|4|5, enunciado, alternativas:[...], correta: 'A'|'B'|'C'|'D'|'E'}
    const questionBank = [
      // === Aula 1 (Fluxo de matéria e energia / Pirâmides) – 10 ===
      {
        id: 'A1Q1',
        aula: 1,
        enunciado: 'Em um período prolongado de céu nublado no Cerrado, agricultores observaram queda na frutificação e equipes de monitoramento registraram redução na atividade de quatis. Considerando a entrada de energia nos ecossistemas e a dependência trófica entre níveis, explique por que oscilações na radiação solar podem desencadear efeitos em cascata sobre consumidores onívoros.',
        alternativas: [
          'A menor luz reduz a fotossíntese, diminuindo biomassa de produtores e a energia disponível aos demais níveis, afetando a dieta e a densidade populacional de onívoros como os quatis.',
          'A ausência de sol acelera a respiração das plantas, liberando mais energia aproveitada diretamente pelos consumidores, o que estabiliza o sistema.',
          'Com menos radiação, decompositores assumem a produção primária de energia, mantendo intacto o fluxo energético.',
          'A baixa luminosidade aumenta a taxa de predação sobre quatis, única explicação para a queda observada.',
          'A umidade do solo substitui a energia luminosa, mantendo a produtividade primária inalterada.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q2',
        aula: 1,
        enunciado: 'Quatis consomem frutos, insetos e ovos, alterando sua posição trófica conforme a disponibilidade. Em ambientes sazonais e sujeitos a distúrbios, como queimadas controladas, que vantagem ecológica essa onivoria oferece quanto ao fluxo de energia e matéria?',
        alternativas: [
          'Aumenta a resiliência populacional ao permitir transitar entre fontes energéticas distintas, reduzindo a vulnerabilidade a flutuações na base produtora.',
          'Diminui a eficiência energética porque cada mudança de dieta bloqueia a transferência de energia entre níveis.',
          'Compromete a teia alimentar por eliminar a competição interespecífica.',
          'Dispensa decompositores, pois onívoros reciclam a biomassa integralmente.',
          'Impede a transferência de energia aos níveis superiores, interrompendo a cadeia alimentar.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q3',
        aula: 1,
        enunciado: 'Num ano de safra abundante de goiabeiras, a população de quatis cresceu. À luz das pirâmides ecológicas, como a ampliação da base energética pode afetar níveis superiores e interações bióticas?',
        alternativas: [
          'A produção primária maior amplia a energia no primeiro nível trófico, sustentando populações superiores e modulando predação e competição.',
          'A abundância elimina pressões seletivas de predadores, levando a crescimento indefinido.',
          'O excesso de biomassa substitui a necessidade de radiação solar, reduzindo perdas energéticas.',
          'A entrada extra de energia torna decompositores desnecessários para ciclar matéria.',
          'Variações sazonais não alteram a disponibilidade de energia nos ecossistemas naturais.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q4',
        aula: 1,
        enunciado: 'Por que a pirâmide de energia nunca é invertida, ao contrário das pirâmides de biomassa e de números, em certos casos?',
        alternativas: [
          'Cada transferência trófica envolve dissipação de energia (calor), de modo que a base produtora sempre concentra a maior quantidade de energia do sistema.',
          'Consumidores secundários acumulam sempre mais energia que produtores, mas menos que decompositores.',
          'A pirâmide de energia representa número de indivíduos, inevitavelmente maior na base.',
          'Decompositores reinjetam energia para compensar todas as perdas, evitando inversões.',
          'A pirâmide de energia independe de luz e nutrientes, mantendo-se estável.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q5',
        aula: 1,
        enunciado: 'Uma inundação devastou a vegetação ribeirinha, reduzindo insetos e pequenos mamíferos. Qual o efeito imediato esperado sobre consumidores onívoros em termos de fluxo energético?',
        alternativas: [
          'Queda populacional pela redução da entrada de energia (produtividade primária) e da oferta alimentar em cascata.',
          'Aumento populacional, pois decompositores substituem produtores como base energética.',
          'Estabilidade garantida pela plasticidade alimentar, sem efeitos mensuráveis.',
          'Crescimento por redução da competição interestadual entre predadores.',
          'Equilíbrio imediato, já que mais água sempre eleva a fotossíntese.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q6',
        aula: 1,
        enunciado: 'Dados: Produtores 1000 kcal; Consumidores primários 500 kcal; Consumidores secundários 200 kcal. Qual interpretação é mais adequada?',
        alternativas: [
          'Pirâmide de energia normal: perdas metabólicas a cada nível impedem acúmulo nos níveis superiores.',
          'Pirâmide de energia invertida: consumidores acumulam mais que produtores.',
          'Pirâmide de números: valores calóricos equivalem a indivíduos.',
          'Sistema autossustentável: soma dos consumidores = energia dos produtores.',
          'Consumidores terciários sustentam a base da cadeia.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q7',
        aula: 1,
        enunciado: 'Chuvas intensas lixiviaram nutrientes, insetos ficaram menores e com menor biomassa, mas o número de indivíduos não mudou. Por que consumidores superiores reduziram?',
        alternativas: [
          'A qualidade da biomassa (energia por indivíduo) caiu, diminuindo o aporte aos níveis superiores.',
          'O fluxo de energia independe de condições abióticas; a causa foi demográfica.',
          'Quatis passaram a competir canibalisticamente.',
          'Decompositores foram eliminados, interrompendo o ciclo.',
          'Mesmo número de herbívoros mantém igual energia total.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q8',
        aula: 1,
        enunciado: 'Após incêndio, cinzas enriqueceram o solo e gramíneas prosperaram, atraindo aves e beneficiando quatis. O que isso revela sobre distúrbios e fluxo de matéria?',
        alternativas: [
          'Distúrbios podem acelerar o ciclo de nutrientes, beneficiando grupos oportunistas e alterando temporariamente fluxos energéticos.',
          'Incêndios comprometem irreversivelmente a biodiversidade, sem regeneração.',
          'Perda vegetal implica queda definitiva do fluxo energético.',
          'Cinzas substituem decompositores convertendo matéria em energia química utilizável.',
          'Sucessão depende apenas de predadores.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q9',
        aula: 1,
        enunciado: 'A sequência Mangaba → Insetos → Sapos → Quatis, usada didaticamente, descreve o quê?',
        alternativas: [
          'Uma cadeia alimentar linear que simplifica um fluxo que, na natureza, ocorre em teias.',
          'Uma teia alimentar complexa com múltiplas conexões simultâneas.',
          'Uma pirâmide de biomassa entre níveis.',
          'Um ciclo biogeoquímico do carbono.',
          'Um mutualismo obrigatório.'
        ],
        correta: 'A'
      },
      {
        id: 'A1Q10',
        aula: 1,
        enunciado: 'Em área de cerrado: 3 buritis (produtores), 7 aves e 15 quatis. Como fica a pirâmide de números?',
        alternativas: [
          'Invertida: poucos produtores sustentando mais consumidores, pois abundância depende da biomassa por indivíduo, não só da contagem.',
          'Normal: produtores sempre são mais numerosos.',
          'De energia: reflete produtividade.',
          'De biomassa: acúmulo de matéria nos níveis superiores.',
          'Estável: proporções equilibradas.'
        ],
        correta: 'A'
      },

      // === Aula 2 (Ciclos do carbono e oxigênio) – 10 ===
      {
        id: 'A2Q1',
        aula: 2,
        enunciado: 'A queima acelerada de combustíveis fósseis libera em décadas o carbono estocado por milhões de anos. Explique o impacto sobre os ciclos do carbono e do oxigênio e o balanço térmico do planeta.',
        alternativas: [
          'Eleva CO₂ atmosférico, intensifica o efeito estufa e altera o equilíbrio térmico; em paralelo, pressiona o balanço O₂/CO₂ na biosfera.',
          'Reduz carbono nos oceanos, impedindo formação de carbonatos e zerando o efeito estufa.',
          'Aumenta fotossíntese terrestre a ponto de superproduzir oxigênio e resfriar o clima.',
          'Inibe decompositores, interrompendo a ciclagem natural.',
          'Neutraliza a respiração celular por excesso de carbono.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q2',
        aula: 2,
        enunciado: 'Na fotossíntese, plantas absorvem CO₂ e liberam O₂. Na respiração, consomem O₂ e liberam CO₂. Como esses processos se equilibram em uma floresta madura?',
        alternativas: [
          'Em florestas maduras, fotossíntese e respiração se equilibram aproximadamente, com balanço líquido próximo de zero para CO₂ e O₂.',
          'Fotossíntese sempre supera respiração, gerando excesso contínuo de oxigênio.',
          'Respiração domina, causando perda líquida de oxigênio.',
          'Não há relação entre fotossíntese e respiração em florestas.',
          'Decompositores eliminam todo o oxigênio produzido.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q3',
        aula: 2,
        enunciado: 'Oceanos absorvem CO₂ atmosférico, formando ácido carbônico e reduzindo o pH. Como isso afeta organismos marinhos calcificadores?',
        alternativas: [
          'A acidificação dificulta a formação de conchas e esqueletos calcários, ameaçando corais, moluscos e outros organismos.',
          'pH baixo acelera a calcificação, fortalecendo conchas.',
          'Organismos marinhos são imunes a mudanças de pH.',
          'Acidificação só afeta plantas terrestres.',
          'CO₂ oceânico não forma ácidos.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q4',
        aula: 2,
        enunciado: 'Desmatamento reduz a capacidade de absorção de CO₂ e libera carbono estocado na biomassa. Qual o impacto duplo sobre o ciclo do carbono?',
        alternativas: [
          'Reduz sumidouros de carbono (menos fotossíntese) e aumenta fontes (queima/decomposição), elevando CO₂ atmosférico.',
          'Aumenta apenas a fotossíntese, sem afetar emissões.',
          'Elimina apenas fontes de carbono, reduzindo CO₂.',
          'Não afeta o ciclo do carbono.',
          'Compensa automaticamente via respiração oceânica.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q5',
        aula: 2,
        enunciado: 'Durante a fotossíntese, a água é quebrada (fotólise) liberando oxigênio. De onde vem especificamente o O₂ liberado?',
        alternativas: [
          'O oxigênio liberado provém da molécula de água (H₂O), não do CO₂ absorvido.',
          'O oxigênio vem exclusivamente do CO₂.',
          'Metade vem da água, metade do CO₂.',
          'O oxigênio é produzido pela respiração celular.',
          'Vem da quebra de açúcares.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q6',
        aula: 2,
        enunciado: 'Bactérias decompositoras consomem matéria orgânica e liberam CO₂. Como isso se relaciona com o ciclo do carbono?',
        alternativas: [
          'Decompositores reciclam carbono da matéria orgânica morta de volta à atmosfera como CO₂, fechando o ciclo.',
          'Decompositores fixam carbono permanentemente no solo.',
          'Decompositores produzem oxigênio a partir de matéria orgânica.',
          'Decompositores não participam do ciclo do carbono.',
          'Decompositores convertem CO₂ em metano exclusivamente.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q7',
        aula: 2,
        enunciado: 'Fitoplâncton marinho realiza fotossíntese em grande escala. Qual sua importância para os ciclos globais de carbono e oxigênio?',
        alternativas: [
          'Produz grande parte do oxigênio atmosférico e absorve CO₂, sendo fundamental para o equilíbrio climático global.',
          'Produz apenas CO₂, sem afetar oxigênio.',
          'Só afeta ciclos locais, não globais.',
          'Consome oxigênio sem produzir.',
          'Não realiza fotossíntese.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q8',
        aula: 2,
        enunciado: 'Combustíveis fósseis são formados por matéria orgânica antiga. Por que sua queima altera o equilíbrio atmosférico atual?',
        alternativas: [
          'Libera carbono que estava fora do ciclo ativo há milhões de anos, aumentando rapidamente o CO₂ atmosférico.',
          'Libera apenas carbono já presente no ciclo atual.',
          'Não afeta a composição atmosférica.',
          'Reduz CO₂ atmosférico.',
          'Produz oxigênio extra.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q9',
        aula: 2,
        enunciado: 'Em ambientes aquáticos, como lagos, o que acontece com os níveis de oxigênio durante a noite?',
        alternativas: [
          'Diminuem, pois a fotossíntese para (sem luz) mas a respiração de plantas e animais continua consumindo O₂.',
          'Aumentam, pois plantas respiram mais à noite.',
          'Permanecem constantes independente da luz.',
          'Aumentam pela fotossíntese noturna.',
          'Diminuem apenas por evaporação.'
        ],
        correta: 'A'
      },
      {
        id: 'A2Q10',
        aula: 2,
        enunciado: 'Qual processo remove CO₂ da atmosfera e qual processo adiciona CO₂ à atmosfera?',
        alternativas: [
          'Fotossíntese remove CO₂; respiração celular e combustão adicionam CO₂.',
          'Respiração remove CO₂; fotossíntese adiciona CO₂.',
          'Ambos os processos apenas adicionam CO₂.',
          'Ambos os processos apenas removem CO₂.',
          'Nenhum processo afeta CO₂ atmosférico.'
        ],
        correta: 'A'
      },

      // === Aulas 3, 4 e 5 (questões distribuídas) – 6 ===
      {
        id: 'A3Q1',
        aula: 3,
        enunciado: 'Em ecossistemas aquáticos, a estratificação térmica afeta a distribuição de nutrientes e oxigênio. Como isso influencia a produtividade primária?',
        alternativas: [
          'Estratificação limita a mistura de nutrientes, concentrando-os no fundo e reduzindo a produtividade na superfície iluminada.',
          'Estratificação aumenta uniformemente a produtividade em todas as profundidades.',
          'Temperatura não afeta a distribuição de nutrientes.',
          'Estratificação elimina a necessidade de luz para fotossíntese.',
          'Nutrientes se concentram sempre na superfície.'
        ],
        correta: 'A'
      },
      {
        id: 'A3Q2',
        aula: 3,
        enunciado: 'Eutrofização artificial por fertilizantes causa proliferação de algas. Como isso afeta o ciclo do oxigênio no ambiente aquático?',
        alternativas: [
          'Inicialmente aumenta O₂ (fotossíntese das algas), depois causa depleção severa quando algas morrem e decompõem.',
          'Sempre aumenta oxigênio indefinidamente.',
          'Sempre diminui oxigênio desde o início.',
          'Não afeta os níveis de oxigênio.',
          'Elimina completamente o oxigênio imediatamente.'
        ],
        correta: 'A'
      },
      {
        id: 'A4Q1',
        aula: 4,
        enunciado: 'Microrganismos fixadores de nitrogênio convertem N₂ atmosférico em amônia. Por que esse processo é essencial para os ecossistemas?',
        alternativas: [
          'Torna o nitrogênio atmosférico disponível para plantas, que não conseguem usar N₂ diretamente.',
          'Elimina nitrogênio tóxico do ambiente.',
          'Produz oxigênio como subproduto.',
          'Reduz a quantidade de nitrogênio no solo.',
          'Converte amônia em nitrogênio gasoso.'
        ],
        correta: 'A'
      },
      {
        id: 'A4Q2',
        aula: 4,
        enunciado: 'Bactérias nitrificantes oxidam amônia a nitrito e depois a nitrato. Qual a importância ecológica desse processo?',
        alternativas: [
          'Converte formas de nitrogênio em nitrato, a forma mais facilmente absorvida pelas plantas.',
          'Elimina nitrogênio do ecossistema.',
          'Produz energia para fotossíntese.',
          'Fixa nitrogênio atmosférico.',
          'Reduz a fertilidade do solo.'
        ],
        correta: 'A'
      },
      {
        id: 'A5Q1',
        aula: 5,
        enunciado: 'Fungos micorrízicos formam associações com raízes de plantas. Como essa simbiose afeta a ciclagem de nutrientes?',
        alternativas: [
          'Aumenta a absorção de fósforo e outros nutrientes pelas plantas, melhorando a eficiência da ciclagem.',
          'Impede a absorção de nutrientes pelas plantas.',
          'Só beneficia os fungos, prejudicando as plantas.',
          'Não afeta a ciclagem de nutrientes.',
          'Elimina a necessidade de fertilizantes completamente.'
        ],
        correta: 'A'
      },
      {
        id: 'A5Q2',
        aula: 5,
        enunciado: 'Em solos ácidos, a disponibilidade de alguns nutrientes diminui. Como isso afeta o crescimento das plantas?',
        alternativas: [
          'Reduz a absorção de nutrientes essenciais como fósforo, limitando o crescimento mesmo com fertilização.',
          'Aumenta a absorção de todos os nutrientes.',
          'Não afeta a disponibilidade de nutrientes.',
          'Melhora automaticamente a fertilidade do solo.',
          'Elimina a necessidade de correção do pH.'
        ],
        correta: 'A'
      }
    ];

    // ======= Estado da aplicação =======
    const state = {
      respostas: {},
      timers: {},
      ordemQuestoes: [],
      progressEl: null,
      statusEl: null,
      sendBtn: null
    };

    // ======= Utilitários =======
    const utils = {
      shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      },

      formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      },

      createElement(tag, className = '', content = '') {
        const element = document.createElement(tag);
        if (className) element.className = className;
        if (content) element.textContent = content;
        return element;
      }
    };

    // ======= Gerenciamento de Timer =======
    const timerManager = {
      start(questionId) {
        if (state.timers[questionId]?.running) return;
        
        state.timers[questionId] = {
          start: Date.now(),
          elapsed: 0,
          running: true,
          interval: setInterval(() => this.update(questionId), 1000)
        };
        this.update(questionId);
      },

      stop(questionId) {
        const timer = state.timers[questionId];
        if (!timer?.running) return;
        
        timer.running = false;
        timer.elapsed = Date.now() - timer.start;
        clearInterval(timer.interval);
        this.update(questionId);
      },

      update(questionId) {
        const timer = state.timers[questionId];
        const timerEl = document.getElementById(`timer-${questionId}`);
        
        if (!timer || !timerEl) return;
        
        const elapsed = timer.running 
          ? Math.floor((Date.now() - timer.start) / 1000)
          : Math.floor(timer.elapsed / 1000);
        
        timerEl.textContent = utils.formatTime(elapsed);
      }
    };

    // ======= Renderização das questões =======
    const questionRenderer = {
      selectQuestions() {
        const aulaGroups = {};
        
        // Agrupa questões por aula
        questionBank.forEach(q => {
          if (!aulaGroups[q.aula]) aulaGroups[q.aula] = [];
          aulaGroups[q.aula].push(q);
        });
        
        const selected = [];
        
        // Seleciona 2 questões de cada aula (1-5)
        for (let aula = 1; aula <= 5; aula++) {
          const questoesAula = aulaGroups[aula] || [];
          const shuffled = utils.shuffle(questoesAula);
          selected.push(...shuffled.slice(0, 2));
        }
        
        return utils.shuffle(selected);
      },

      renderQuestion(question, index) {
        const card = utils.createElement('div', 'question-card');
        card.id = `card-${question.id}`;
        
        // Embaralha alternativas mantendo o mapeamento
        const shuffledAlts = utils.shuffle(
          question.alternativas.map((alt, i) => ({
            text: alt,
            letter: String.fromCharCode(65 + i) // A, B, C, D, E
          }))
        );
        
        card.innerHTML = `
          <div class="question-header">
            <span class="question-number">Questão ${index + 1}</span>
            <span id="timer-${question.id}" class="question-timer">00:00</span>
          </div>
          <div class="question-statement">${question.enunciado}</div>
          <div class="alternatives">
            ${shuffledAlts.map((alt, altIndex) => `
              <label class="alternative">
                <input 
                  type="radio" 
                  name="question_${question.id}" 
                  value="${alt.letter}"
                  id="q${question.id}_${altIndex}"
                  aria-describedby="question-${question.id}-statement"
                >
                <span>${alt.text}</span>
              </label>
            `).join('')}
          </div>
        `;
        
        // Adiciona event listeners
        card.querySelectorAll('input[type="radio"]').forEach(input => {
          input.addEventListener('change', (e) => {
            // Garante que apenas uma alternativa seja selecionada por questão
            if (e.target.checked) {
              this.handleAnswer(question.id, input.value);
            }
          });
          
          input.addEventListener('focus', () => {
            if (!state.timers[question.id]?.running && !(question.id in state.respostas)) {
              timerManager.start(question.id);
            }
          });
        });
        
        return card;
      },

      handleAnswer(questionId, selectedLetter) {
        // Verifica se a questão já foi respondida
        if (questionId in state.respostas) {
          return; // Já foi respondida, não permite mudança
        }
        
        // Para o timer e trava a questão
        timerManager.stop(questionId);
        state.respostas[questionId] = selectedLetter;
        
        // Trava a UI da questão
        const card = document.getElementById(`card-${questionId}`);
        const inputs = card.querySelectorAll('input[type="radio"]');
        
        inputs.forEach(input => {
          input.disabled = true;
          // Mantém apenas a alternativa selecionada marcada
          if (input.value === selectedLetter) {
            input.checked = true;
          } else {
            input.checked = false;
          }
        });
        
        card.classList.add('question-card--locked');
        this.updateProgress();
      },

      updateProgress() {
        const count = Object.keys(state.respostas).length;
        const studentSelected = document.getElementById('student').value;
        
        state.progressEl.textContent = `${count}/10 respondidas`;
        state.sendBtn.disabled = count < 10 || !studentSelected;
      }
    };

    // ======= Gerenciamento de alunos =======
    const studentManager = {
      init() {
        const select = document.getElementById('student');
        const numeroInput = document.getElementById('numero');
        
        // Popula o select
        select.innerHTML = '<option value="">— selecione —</option>' + 
          alunos.map(([num, nome]) => 
            `<option value="${nome}">${nome}</option>`
          ).join('');
        
        // Event listener para mudança de aluno
        select.addEventListener('change', () => {
          const nome = select.value;
          const aluno = alunos.find(([, n]) => n === nome);
          numeroInput.value = aluno ? aluno[0] : '';
          questionRenderer.updateProgress();
        });
      }
    };

    // ======= Envio para Google Sheets =======
    const submissionManager = {
      async submit() {
        if (!SCRIPT_URL || SCRIPT_URL.includes('COLE_AQUI')) {
          this.showStatus('Configure a URL do Web App do Google Apps Script para enviar.', 'error');
          return;
        }
        
        const studentSelect = document.getElementById('student');
        const numeroInput = document.getElementById('numero');
        
        const payload = {
          aluno: studentSelect.value || '',
          numero: numeroInput.value || '',
          respostas: state.ordemQuestoes.map(id => ({
            id,
            resposta: state.respostas[id] || ''
          })),
          tempos: this.getTimings(),
          ordemQuestoes: state.ordemQuestoes
        };
        
        try {
          this.showStatus('Enviando…', 'info');
          
          const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          
          const data = await response.json();
          
          if (data.ok) {
            this.showStatus('Enviado com sucesso!', 'success');
          } else {
            this.showStatus(`Falha ao enviar: ${data.erro || 'Erro desconhecido'}`, 'error');
          }
        } catch (error) {
          this.showStatus(`Erro de rede: ${error.message}`, 'error');
        }
      },

      getTimings() {
        const timings = {};
        Object.keys(state.timers).forEach(id => {
          const timer = state.timers[id];
          timings[id] = timer.elapsed ? Math.round(timer.elapsed / 1000) : 0;
        });
        return timings;
      },

      showStatus(message, type) {
        state.statusEl.innerHTML = `<span class="status--${type}">${message}</span>`;
      }
    };

    // ======= Inicialização da aplicação =======
    const app = {
      init() {
        // Inicializa elementos do DOM
        state.progressEl = document.getElementById('progress');
        state.statusEl = document.getElementById('status');
        state.sendBtn = document.getElementById('send');
        
        // Configura event listeners
        state.sendBtn.addEventListener('click', () => submissionManager.submit());
        
        // Inicializa componentes
        studentManager.init();
        this.renderQuiz();
      },

      renderQuiz() {
        const quizContainer = document.getElementById('quiz');
        const selectedQuestions = questionRenderer.selectQuestions();
        
        // Armazena a ordem das questões
        state.ordemQuestoes = selectedQuestions.map(q => q.id);
        
        // Renderiza cada questão
        selectedQuestions.forEach((question, index) => {
          const questionElement = questionRenderer.renderQuestion(question, index);
          quizContainer.appendChild(questionElement);
        });
        
        // Atualiza o progresso inicial
        questionRenderer.updateProgress();
      }
    };

    // ======= Inicialização quando o DOM estiver pronto =======
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => app.init());
    } else {
      app.init();
    }
  </script>
</body>
</html>

