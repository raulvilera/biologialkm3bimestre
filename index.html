<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atividade de Biologia – 3º Bimestre</title>
  <style>
    :root{
      --bg:#f7f7fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --brand:#2563eb; --accent:#10b981; --danger:#ef4444; --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink); margin:0;}
    header{background:var(--card); padding:24px; box-shadow:var(--shadow); position:sticky; top:0; z-index:5}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    label{font-size:14px; color:var(--muted)}
    select, input[type="text"]{padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; width:100%}
    .title{font-weight:800; text-align:center; margin-top:12px; font-size:20px}
    .title b{font-weight:900}
    main{max-width:980px; margin:28px auto; padding:0 16px}
    .card{background:var(--card); border-radius:14px; box-shadow:var(--shadow); padding:18px 18px 12px 18px; margin-bottom:18px}
    .qhead{display:flex; justify-content:space-between; align-items:flex-start; gap:12px;}
    .qnum{font-weight:700; color:var(--brand)}
    .qtimer{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:var(--muted); font-size:12px; background:#eef2ff; border-radius:8px; padding:4px 8px;}
    .enunciado{margin:6px 0 10px 0; line-height:1.5}
    .alts{display:grid; gap:10px;}
    .alt{display:flex; gap:10px; align-items:flex-start; padding:10px; border:1px solid #e5e7eb; border-radius:10px; cursor:pointer;}
    .alt:hover{border-color:#d1d5db; background:#fafafa}
    .alt input{margin-top:3px}
    .locked{opacity:.75}
    .footer{display:flex; justify-content:space-between; align-items:center; gap:12px; padding:12px 0}
    button{background:var(--brand); color:#fff; border:none; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer}
    button:disabled{opacity:.5; cursor:not-allowed}
    .pill{padding:6px 10px; border-radius:999px; font-size:12px; color:#065f46; background:#d1fae5}
    .note{font-size:12px; color:var(--muted)}
    .ok{color:#065f46}
    .err{color:var(--danger)}
    .header-top{display:flex; flex-wrap:wrap; align-items:center; gap:12px; justify-content:space-between}
    .school{font-weight:800; font-size:18px}
    .student{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .student small{color:var(--muted)}
    .num{width:90px}
  </style>
</head>
<body>
  <header>
    <div class="header-top">
      <div class="school">E.E. LYDIA KITZ MOREIRA</div>
      <div class="student">
        <label for="student">NOME:</label>
        <select id="student"></select>
        <div class="row">
          <small>Nº</small>
          <input id="numero" class="num" type="text" placeholder="—" readonly />
        </div>
      </div>
    </div>
    <div class="title"><b>ATIVIDADE DE BIOLOGIA (3º BIMESTRE)</b></div>
  </header>

  <main>
    <div class="note">Serão exibidas 10 questões (2 de cada aula). A ordem das questões e das alternativas muda a cada acesso, mantendo o mesmo gabarito por questão.</div>
    <div id="quiz"></div>
    <div class="card">
      <div class="footer">
        <div>
          <span id="progress" class="pill">0/10 respondidas</span>
          <span id="status" class="note"></span>
        </div>
        <button id="send" disabled>Enviar respostas</button>
      </div>
      <div class="note">As respostas serão registradas na planilha Google Sheets (aba "1ºH").</div>
    </div>
  </main>

  <script>
    /********************
     * ⚠️ IMPORTANTE – Integração com Google Sheets
     * Para gravar as respostas, publique um Google Apps Script como Web App e cole a URL no const SCRIPT_URL abaixo.
     * 1) No Google Drive > Novo > Apps Script.
     * 2) Cole o código do GAS abaixo e substitua o ID pela sua planilha.
     * 3) Implante como Aplicativo da Web (qualquer pessoa com o link) e copie a URL de implantação.
     * 4) Retorne aqui e defina const SCRIPT_URL = 'URL_DA_IMPLANTAÇÃO';
     *
     * // == Código Google Apps Script (GAS) ==
     * const SHEET_ID = '1yGahAlt7tnGbqhv5auMQyNqpIoPg7bYQI34EdGWXUbo';
     * const ABA = '1ºH';
     * function doPost(e){
     *   try{
     *     const ss = SpreadsheetApp.openById(SHEET_ID);
     *     const sh = ss.getSheetByName(ABA);
     *     const body = JSON.parse(e.postData.contents);
     *     // Próxima linha vazia a partir de H4
     *     const startRow = 4; // H4
     *     const col = 8; // coluna H
     *     let row = startRow;
     *     while(sh.getRange(row, col).getValue() !== '') row++;
     *     // Grava um JSON compactado com tudo: cabeçalho, respostas, tempos e carimbo de data/hora
     *     const payload = JSON.stringify({
     *       carimbo: new Date().toISOString(),
     *       aluno: body.aluno,
     *       numero: body.numero,
     *       respostas: body.respostas,
     *       tempos: body.tempos,
     *       ordemQuestoes: body.ordemQuestoes
     *     });
     *     sh.getRange(row, col).setValue(payload);
     *     return ContentService.createTextOutput(JSON.stringify({ok:true,row})).setMimeType(ContentService.MimeType.JSON);
     *   }catch(err){
     *     return ContentService.createTextOutput(JSON.stringify({ok:false,erro:String(err)})).setMimeType(ContentService.MimeType.JSON);
     *   }
     * }
     * // ======================================
     ********************/

    const SCRIPT_URL = 'COLE_AQUI_A_URL_DO_WEB_APP'; // <-- SUBSTITUA após publicar o GAS

    // Lista de alunos (nome -> número) – será usada para autopreencher o Nº
    const alunos = [
      [1,'ALEXANDRE BATISTA DOS SANTOS'],
      [5,'ANA LÍVIA BRAGA DOS SANTOS'],
      [7,'ARTHUR CASTRO SILVA'],
      [11,'DANIELLE OLIVEIRA DA SILVA NUNES'],
      [14,'ELOYSA ANDRADE OLIVEIRA SILVA'],
      [18,'FELIPE MARCONDES SILVA'],
      [19,'GEOVANA FERREIRA DA SILVA SOUZA'],
      [20,'GEOVANNA GABRIELA PIERRE SILVA'],
      [24,'ISAAK ALVAREZ MARQUEZ CAETANO'],
      [30,'KAMILA NEVES BRITO'],
      [33,'KEMILLY VITORIA RODRIGUES MARIANO'],
      [34,'LAURA LUIZA DOS SANTOS ALMEIDA'],
      [37,'MARIA EDUARDA VENCESLAU DE SOUZA'],
      [38,'MATHEUS CAVALCANTE LISBOA'],
      [40,'MURILLO SOUZA RODRIGUES DOS SANTOS'],
      [45,'PEDRO HENRIQUE MAURICIO DA SILVA CHAGAS'],
      [48,'RHUAN LIMA OLIVEIRA'],
      [49,'THAINA FIDELIS XAVIER DA SILVA'],
      [54,'DENIS CASTRO DURVALDO'],
      [56,'ISAAC LEMOS SANTOS'],
      [57,'EMILLY EDUARDA BONIFACIO DE AMORIM CORREA'],
      [58,'RAYSSA GUBEREV FRAGA'],
      [59,'LEONARDO ABADE DA SILVA DANTAS'],
      [61,'MILENA CRISTINA LOPES DE CARVALHO'],
      [62,'PYETRA GOMES MARTINS'],
      [63,'MIRELLA BRITO DA SILVA'],
      [64,'CARLOS EDUARDO MARTINS DA SILVA'],
      [66,'STELLA MARTINS DA SILVA'],
      [67,'DYESSICA MAYARA DOS SANTOS GOMES'],
      [68,'LARISSA DE LOURDES DOS SANTOS'],
      [69,'DAVI AMERICO FEITOSA'],
      [70,'GUSTAVO RODRIGUES DE SOUZA'],
      [71,'PAULO HENRIQUE SOUZA MARTELO'],
      [72,'NAYARA BARROS DE MORAIS'],
      [73,'VITÓRIA SANTOS TEIXEIRA'],
      [74,'BRUNA VITORIA DA MOTA OLIVEIRA'],
      [75,'JOÃO PAULO RODRIGUES DE SOUZA FILHO'],
      [76,'MARIA EDUARDA DE OLIVEIRA RODRIGUES'],
      [77,'LUIZ HENRIQUE JESUS DOS SANTOS FABRICIO'],
      [78,'EDUARDO CARRASCOSA PINTOR'],
      [79,'GUILHERME DANIEL VELOSO DOS SANTOS'],
      [80,'JOAO GABRIEL AMORIM TOBIAS'],
      [81,'RIAN SANTOS MACHADO'],
      [82,'JULIA ARAUJO DE LIMA'],
    ];

    // ======= Banco de Questões =======
    // Estrutura: {id, aula:1|2|3|4|5, enunciado, alternativas:[...], correta: 'A'|'B'|'C'|'D'|'E'}
    // Observação: este banco está preparado para 50 questões. Abaixo já inseri 26 (10 da Aula 1, 10 da Aula 2 e 6 distribuídas entre as Aulas 3, 4 e 5).
    const questionBank = [
      // === Aula 1 (Fluxo de matéria e energia / Pirâmides) – 10 ===
      {id:'A1Q1',aula:1,enunciado:'Em um período prolongado de céu nublado no Cerrado, agricultores observaram queda na frutificação e equipes de monitoramento registraram redução na atividade de quatis. Considerando a entrada de energia nos ecossistemas e a dependência trófica entre níveis, explique por que oscilações na radiação solar podem desencadear efeitos em cascata sobre consumidores onívoros.',alternativas:[
        'A menor luz reduz a fotossíntese, diminuindo biomassa de produtores e a energia disponível aos demais níveis, afetando a dieta e a densidade populacional de onívoros como os quatis.',
        'A ausência de sol acelera a respiração das plantas, liberando mais energia aproveitada diretamente pelos consumidores, o que estabiliza o sistema.',
        'Com menos radiação, decompositores assumem a produção primária de energia, mantendo intacto o fluxo energético.',
        'A baixa luminosidade aumenta a taxa de predação sobre quatis, única explicação para a queda observada.',
        'A umidade do solo substitui a energia luminosa, mantendo a produtividade primária inalterada.'
      ],correta:'A'},
      {id:'A1Q2',aula:1,enunciado:'Quatis consomem frutos, insetos e ovos, alterando sua posição trófica conforme a disponibilidade. Em ambientes sazonais e sujeitos a distúrbios, como queimadas controladas, que vantagem ecológica essa onivoria oferece quanto ao fluxo de energia e matéria?',alternativas:[
        'Aumenta a resiliência populacional ao permitir transitar entre fontes energéticas distintas, reduzindo a vulnerabilidade a flutuações na base produtora.',
        'Diminui a eficiência energética porque cada mudança de dieta bloqueia a transferência de energia entre níveis.',
        'Compromete a teia alimentar por eliminar a competição interespecífica.',
        'Dispensa decompositores, pois onívoros reciclam a biomassa integralmente.',
        'Impede a transferência de energia aos níveis superiores, interrompendo a cadeia alimentar.'
      ],correta:'A'},
      {id:'A1Q3',aula:1,enunciado:'Num ano de safra abundante de goiabeiras, a população de quatis cresceu. À luz das pirâmides ecológicas, como a ampliação da base energética pode afetar níveis superiores e interações bióticas?',alternativas:[
        'A produção primária maior amplia a energia no primeiro nível trófico, sustentando populações superiores e modulando predação e competição.',
        'A abundância elimina pressões seletivas de predadores, levando a crescimento indefinido.',
        'O excesso de biomassa substitui a necessidade de radiação solar, reduzindo perdas energéticas.',
        'A entrada extra de energia torna decompositores desnecessários para ciclar matéria.',
        'Variações sazonais não alteram a disponibilidade de energia nos ecossistemas naturais.'
      ],correta:'A'},
      {id:'A1Q4',aula:1,enunciado:'Por que a pirâmide de energia nunca é invertida, ao contrário das pirâmides de biomassa e de números, em certos casos?',alternativas:[
        'Cada transferência trófica envolve dissipação de energia (calor), de modo que a base produtora sempre concentra a maior quantidade de energia do sistema.',
        'Consumidores secundários acumulam sempre mais energia que produtores, mas menos que decompositores.',
        'A pirâmide de energia representa número de indivíduos, inevitavelmente maior na base.',
        'Decompositores reinjetam energia para compensar todas as perdas, evitando inversões.',
        'A pirâmide de energia independe de luz e nutrientes, mantendo-se estável.'
      ],correta:'A'},
      {id:'A1Q5',aula:1,enunciado:'Uma inundação devastou a vegetação ribeirinha, reduzindo insetos e pequenos mamíferos. Qual o efeito imediato esperado sobre consumidores onívoros em termos de fluxo energético?',alternativas:[
        'Queda populacional pela redução da entrada de energia (produtividade primária) e da oferta alimentar em cascata.',
        'Aumento populacional, pois decompositores substituem produtores como base energética.',
        'Estabilidade garantida pela plasticidade alimentar, sem efeitos mensuráveis.',
        'Crescimento por redução da competição interestadual entre predadores.',
        'Equilíbrio imediato, já que mais água sempre eleva a fotossíntese.'
      ],correta:'A'},
      {id:'A1Q6',aula:1,enunciado:'Dados: Produtores 1000 kcal; Consumidores primários 500 kcal; Consumidores secundários 200 kcal. Qual interpretação é mais adequada?',alternativas:[
        'Pirâmide de energia normal: perdas metabólicas a cada nível impedem acúmulo nos níveis superiores.',
        'Pirâmide de energia invertida: consumidores acumulam mais que produtores.',
        'Pirâmide de números: valores calóricos equivalem a indivíduos.',
        'Sistema autossustentável: soma dos consumidores = energia dos produtores.',
        'Consumidores terciários sustentam a base da cadeia.'
      ],correta:'A'},
      {id:'A1Q7',aula:1,enunciado:'Chuvas intensas lixiviaram nutrientes, insetos ficaram menores e com menor biomassa, mas o número de indivíduos não mudou. Por que consumidores superiores reduziram?',alternativas:[
        'A qualidade da biomassa (energia por indivíduo) caiu, diminuindo o aporte aos níveis superiores.',
        'O fluxo de energia independe de condições abióticas; a causa foi demográfica.',
        'Quatis passaram a competir canibalisticamente.',
        'Decompositores foram eliminados, interrompendo o ciclo.',
        'Mesmo número de herbívoros mantém igual energia total.'
      ],correta:'A'},
      {id:'A1Q8',aula:1,enunciado:'Após incêndio, cinzas enriqueceram o solo e gramíneas prosperaram, atraindo aves e beneficiando quatis. O que isso revela sobre distúrbios e fluxo de matéria?',alternativas:[
        'Distúrbios podem acelerar o ciclo de nutrientes, beneficiando grupos oportunistas e alterando temporariamente fluxos energéticos.',
        'Incêndios comprometem irreversivelmente a biodiversidade, sem regeneração.',
        'Perda vegetal implica queda definitiva do fluxo energético.',
        'Cinzas substituem decompositores convertendo matéria em energia química utilizável.',
        'Sucessão depende apenas de predadores.'
      ],correta:'A'},
      {id:'A1Q9',aula:1,enunciado:'A sequência Mangaba → Insetos → Sapos → Quatis, usada didaticamente, descreve o quê?',alternativas:[
        'Uma cadeia alimentar linear que simplifica um fluxo que, na natureza, ocorre em teias.',
        'Uma teia alimentar complexa com múltiplas conexões simultâneas.',
        'Uma pirâmide de biomassa entre níveis.',
        'Um ciclo biogeoquímico do carbono.',
        'Um mutualismo obrigatório.'
      ],correta:'A'},
      {id:'A1Q10',aula:1,enunciado:'Em área de cerrado: 3 buritis (produtores), 7 aves e 15 quatis. Como fica a pirâmide de números?',alternativas:[
        'Invertida: poucos produtores sustentando mais consumidores, pois abundância depende da biomassa por indivíduo, não só da contagem.',
        'Normal: produtores sempre são mais numerosos.',
        'De energia: reflete produtividade.',
        'De biomassa: acúmulo de matéria nos níveis superiores.',
        'Estável: proporções equilibradas.'
      ],correta:'A'},

      // === Aula 2 (Ciclos do carbono e oxigênio) – 10 ===
      {id:'A2Q1',aula:2,enunciado:'A queima acelerada de combustíveis fósseis libera em décadas o carbono estocado por milhões de anos. Explique o impacto sobre os ciclos do carbono e do oxigênio e o balanço térmico do planeta.',alternativas:[
        'Eleva CO₂ atmosférico, intensifica o efeito estufa e altera o equilíbrio térmico; em paralelo, pressiona o balanço O₂/CO₂ na biosfera.',
        'Reduz carbono nos oceanos, impedindo formação de carbonatos e zerando o efeito estufa.',
        'Aumenta fotossíntese terrestre a ponto de superproduzir oxigênio e resfriar o clima.',
        'Inibe decompositores, interrompendo a ciclagem natural.',
        'Neutraliza a respiração celular por excesso de carbono.'
      ],correta:'A'},
      {id:'A2Q2',aula:2,enunciado:'Na fotossíntese, plantas e algas fixam carbono inorgânico usando energia luminosa e liberam O₂. Qual é a importância integradora desse processo entre diferentes ciclos?',alternativas:[
        'Conecta ciclos do carbono, oxigênio e água: requer CO₂ e H₂O, produz matéria orgânica e O₂, sustentando cadeias alimentares.',
        'Substitui decompositores, dispensando a ciclagem de nutrientes.',
        'Garante O₂ sem depender de água ou CO₂.',
        'Converte energia química em luminosa para consumidores.',
        'Ocorre só em ambiente aquático, razão do O₂ oceânico.'
      ],correta:'A'},
      {id:'A2Q3',aula:2,enunciado:'A respiração celular aeróbia consome O₂ e oxida moléculas orgânicas, liberando CO₂. No acoplamento com a fotossíntese, qual é seu papel nos ciclos de C e O?',alternativas:[
        'Libera CO₂ à atmosfera enquanto consome O₂, fechando o balanço com a fotossíntese que faz o inverso.',
        'Incorpora CO₂ atmosférico como via primária de fixação.',
        'Aumenta energia luminosa para heterótrofos.',
        'Substitui fotossíntese em baixa luz para gerar O₂.',
        'Acumula carbono em rochas calcárias.'
      ],correta:'A'},
      {id:'A2Q4',aula:2,enunciado:'Uma laranja em decomposição exala odores e libera gases. O que esse processo evidencia sobre o ciclo do carbono e o uso do oxigênio por decompositores?',alternativas:[
        'Decompositores consomem carbono orgânico e liberam CO₂ (ou CH₄), usando O₂ em seu metabolismo, reinserindo matéria no ciclo.',
        'Produção primária bruta do sistema.',
        'Absorção de O₂ pelas plantas para formar glicose.',
        'Estocagem permanente de carbono em fósseis.',
        'Transferência direta de O₂ para produtores sem fotossíntese.'
      ],correta:'A'},
      {id:'A2Q5',aula:2,enunciado:'A água provê elétrons na fotólise e libera O₂, sustentando a síntese de matéria orgânica. Qual sua função integradora nos ciclos?',alternativas:[
        'É essencial ao conectar água, carbono e oxigênio, sustentando a produção de glicose e o balanço gasoso.',
        'É apenas acessória: restringe-se à transpiração.',
        'É dispensável: bastariam CO₂ e luz.',
        'Repõe carbono perdido na respiração.',
        'É limitante só em mares devido à salinidade.'
      ],correta:'A'},
      {id:'A2Q6',aula:2,enunciado:'Nos oceanos, íons carbonato e bicarbonato participam de conchas e recifes. Qual a importância desse reservatório geológico no clima e na biota?',alternativas:[
        'Atua como sumidouro de longa duração, modulando CO₂ e apoiando a biodiversidade marinha.',
        'É irrelevante por tornar o carbono indisponível biologicamente.',
        'Substitui plantas terrestres na fotossíntese.',
        'Elimina a necessidade de decompositores.',
        'Repõe imediatamente CO₂ na atmosfera de forma contínua.'
      ],correta:'A'},
      {id:'A2Q7',aula:2,enunciado:'Desmatamento + emissões industriais alteram diretamente os ciclos. Qual efeito composto é esperado?',alternativas:[
        'Mais CO₂ e menos O₂ disponíveis, pressionando a fotossíntese e deslocando o equilíbrio entre os ciclos.',
        'Decomposição passa a liberar O₂ em excesso.',
        'Respiração celular é reduzida por abundância de carbono.',
        'Ciclo da água é neutralizado e não interage mais.',
        'Plantas compensam integralmente o excesso de carbono.'
      ],correta:'A'},
      {id:'A2Q8',aula:2,enunciado:'Erupções vulcânicas liberam CO₂ das rochas para a atmosfera. O que isso indica sobre a interação entre reservatórios?',alternativas:[
        'O ciclo geológico conecta-se ao atmosférico, transferindo carbono abiótico ao sistema vivo.',
        'Carbono fóssil é independente e fora da dinâmica ecológica.',
        'Vulcanismo neutraliza fotossíntese e reduz O₂.',
        'Fixação biológica de N₂ compensa rapidamente o CO₂.',
        'Processos geológicos não influenciam seres vivos.'
      ],correta:'A'},
      {id:'A2Q9',aula:2,enunciado:'Em lavoura de milho, há fotossíntese diurna (CO₂ → matéria orgânica + O₂) e respiração noturna (matéria orgânica + O₂ → CO₂). Qual o resultado atmosférico dessa alternância?',alternativas:[
        'Equilíbrio dinâmico entre fluxos de CO₂ e O₂, regulando a disponibilidade gasosa.',
        'Acúmulo indefinido de carbono no solo.',
        'Produção contínua de glicose sem luz.',
        'Fixação direta de N₂ pela cultura.',
        'Estocagem permanente de O₂ sem consumo.'
      ],correta:'A'},
      {id:'A2Q10',aula:2,enunciado:'Tradições Ticuna sobre a camada de folhas (ngaura) descrevem renovação do solo. Em termos científicos, o que essa prática observa?',alternativas:[
        'A ciclagem do carbono: serapilheira decomposta reintegra nutrientes ao solo e ao fluxo da vida.',
        'Geração autônoma de energia pelo solo, dispensando fotossíntese.',
        'Estoque indefinido de carbono na liteira.',
        'Circulação apenas de água, sem ligação com outros elementos.',
        'Ciclagem exclusiva em ambientes aquáticos.'
      ],correta:'A'},

      // === Aula 3 (Ciclo do nitrogênio) – 2 (ponto de partida) ===
      {id:'A3Q1',aula:3,enunciado:'Em sistemas agrícolas, a rotação com leguminosas reduz a dependência de fertilizantes sintéticos. Explique, no contexto do ciclo do nitrogênio, por que associações com rizóbios impactam produtividade e qualidade ambiental.',alternativas:[
        'Bactérias fixadoras em nódulos convertem N₂ atmosférico em amônio, incorporado ao solo/plantas; reduz perdas por lixiviação, dependência de N sintético e emissões associadas.',
        'As leguminosas absorvem diretamente N₂ sem intermediação bacteriana, eliminando a amonificação.',
        'A simbiose converte nitrato em nitrogênio líquido estável, indisponível biologicamente.',
        'Rizóbios aceleram desnitrificação, libertando N₂ e reduzindo a fertilidade.',
        'A prática aumenta o fósforo disponível, não afetando o nitrogênio.'
      ],correta:'A'},
      {id:'A3Q2',aula:3,enunciado:'Áreas alagadas artificiais (wetlands) tratam efluentes ao promover nitrificação e desnitrificação. Como esses processos sequenciais removem nitrogênio reativo da água?',alternativas:[
        'Nitrificação oxida NH₄⁺ a NO₃⁻ em condições oxigenadas; zonas anóxicas subsequentes promovem desnitrificação, reduzindo NO₃⁻ a N₂ gasoso, removendo o excesso.',
        'Amonificação transforma N₂ em aminoácidos, precipitando o nitrogênio.',
        'Fixação assimilatória converte NO₃⁻ em rochas nitrogenadas estáveis.',
        'Quimiossíntese gera NO₂⁻, que se acumula indefinidamente.',
        'A desnitrificação ocorre somente na presença de luz intensa e clorofila.'
      ],correta:'A'},

      // === Aula 4 (Ecologia de populações e conservação) – 2 (ponto de partida) ===
      {id:'A4Q1',aula:4,enunciado:'Uma UC observa crescimento de uma espécie invasora após abertura de estrada. Discuta mecanismos ecológicos (dispersão, efeito de borda, ausência de inimigos naturais) e consequências sobre a população nativa.',alternativas:[
        'Estradas aumentam propagação (sementes/propágulos), criam bordas com microclimas favoráveis e, sem inimigos naturais, a invasora supera nativas por competição/aleopatia, reduzindo abundância e nichos.',
        'Aberturas viárias tendem a isolar invasoras, limitando sua expansão por falta de luz nas bordas.',
        'A presença de predadores generalistas impede qualquer efeito de borda.',
        'A invasora depende de queimadas anuais e colapsa sem elas, logo estradas reduzem sua população.',
        'Populações nativas aumentam por facilitação obrigatória com a invasora.'
      ],correta:'A'},
      {id:'A4Q2',aula:4,enunciado:'Em manejo de fauna, a capacidade de suporte (K) é central. Um programa de suplementação alimentar elevou temporariamente o número de cervídeos acima de K. O que ocorre a seguir?',alternativas:[
        'Sem manutenção do aporte, a população tende a decrescer por competição e limitação de recursos, oscilando ao redor de K ou abaixo, até novo equilíbrio.',
        'O aumento redefine K permanentemente, independentemente do habitat.',
        'A população continua crescendo exponencialmente por inércia demográfica.',
        'Predadores eliminam o superávit e estabilizam acima de K.',
        'O sistema entra em colapso irreversível por perda de variabilidade genética imediata.'
      ],correta:'A'},

      // === Aula 5 (Impactos ambientais / sustentabilidade) – 2 (ponto de partida) ===
      {id:'A5Q1',aula:5,enunciado:'Uma cidade adota coleta seletiva e compostagem escolar para reduzir resíduos em aterro. Avalie impactos sobre fluxos de matéria/energia e sobre emissões de gases climáticos.',alternativas:[
        'Compostagem retorna matéria orgânica ao solo (ciclagem de carbono/nutrientes), reduz metano de aterros e melhora estrutura do solo; reciclagem reduz energia/processos de matérias-primas virgens.',
        'Compostagem aumenta metano em relação ao aterro e piora a qualidade do solo.',
        'Reciclagem aumenta consumo energético por duplicar cadeias produtivas.',
        'Fluxos de matéria não são afetados por resíduos urbanos.',
        'Medidas só impactam estética urbana, não ciclos biogeoquímicos.'
      ],correta:'A'},
      {id:'A5Q2',aula:5,enunciado:'Avalie a substituição de motocicletas por bicicletas elétricas em entregas de curta distância quanto a emissões, uso de energia e externalidades urbanas.',alternativas:[
        'Reduz emissões locais e consumo de combustíveis fósseis; melhora qualidade do ar e ruído; demanda gestão de baterias e matriz elétrica para maximizar benefícios.',
        'Aumenta emissões por exigir pedágio urbano e semáforos inteligentes.',
        'Não altera energia, pois eletricidade e gasolina têm o mesmo impacto unitário.',
        'Piora ruído urbano e congestiona vias por largura das bicicletas.',
        'Elimina emissões globais independentemente da matriz elétrica.'
      ],correta:'A'},
    ];

    // ======= Lógica de seleção =======
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr }

    function pickTwoPerAula(bank){
      const byAula = {1:[],2:[],3:[],4:[],5:[]};
      bank.forEach(q=>byAula[q.aula]?.push(q));
      const picked=[];
      for(let aula=1;aula<=5;aula++){
        const pool = [...byAula[aula]];
        shuffle(pool);
        if(pool.length<2){
          console.warn('Banco insuficiente para a aula', aula, `(tem ${pool.length}, necessário 2)`);
        }
        picked.push(...pool.slice(0,2));
      }
      return picked;
    }

    // ======= Renderização =======
    const quizEl = document.getElementById('quiz');
    const progressEl = document.getElementById('progress');
    const statusEl = document.getElementById('status');
    const sendBtn = document.getElementById('send');

    const timers = {}; // {id:{running:false,start:ms,elapsed:ms}}
    const respostas = {}; // {id:'A'|'B'|'C'|'D'|'E'}
    let ordemQuestoes = [];

    function render(){
      const selected = pickTwoPerAula(questionBank);
      ordemQuestoes = shuffle(selected).map((q,i)=>q.id);
      quizEl.innerHTML='';
      selected.forEach((q, idx)=>{
        const num = idx+1;
        const card = document.createElement('div');
        card.className='card';
        card.id = `card-${q.id}`;

        const qhead = document.createElement('div');
        qhead.className='qhead';
        qhead.innerHTML = `<div class="qnum">Questão ${num} · Aula ${q.aula}</div><div class="qtimer" id="timer-${q.id}">00:00</div>`;

        const enun = document.createElement('div');
        enun.className='enunciado';
        enun.textContent = q.enunciado;

        const altsWrap = document.createElement('div');
        altsWrap.className='alts';
        const letters=['A','B','C','D','E'];
        const indices=[0,1,2,3,4];
        shuffle(indices); // embaralha ordem, mas manteremos o gabarito por letra original da questão

        indices.forEach((idxAlt)=>{
          const alt = document.createElement('label');
          alt.className='alt';
          const letter = letters[idxAlt];
          const id = `${q.id}-${letter}`;
          alt.innerHTML = `<input type="radio" name="${q.id}" value="${letter}" id="${id}" /> <div><b>${letter})</b> ${q.alternativas[idxAlt]}</div>`;
          // Inicia/para cronômetro ao clicar
          alt.addEventListener('click', ()=> onAnswer(q.id, letter));
          altsWrap.appendChild(alt);
        });

        card.appendChild(qhead);
        card.appendChild(enun);
        card.appendChild(altsWrap);
        quizEl.appendChild(card);
      });
    }

    // ======= Cronômetro por questão =======
    function fmt(ms){ const s=Math.floor(ms/1000); const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${mm}:${ss}` }
    function tick(id){
      const t = timers[id]; if(!t||!t.running) return;
      const now = performance.now();
      const elapsed = (t.elapsed||0) + (now - t.start);
      document.getElementById(`timer-${id}`).textContent = fmt(elapsed);
      t._raf = requestAnimationFrame(()=>tick(id));
    }
    function startTimer(id){
      if(!timers[id]) timers[id]={running:false,elapsed:0};
      const t = timers[id];
      if(t.running) return;
      t.running=true; t.start=performance.now();
      t._raf = requestAnimationFrame(()=>tick(id));
    }
    function stopTimer(id){
      const t = timers[id]; if(!t||!t.running) return;
      const now = performance.now();
      t.elapsed = (t.elapsed||0) + (now - t.start);
      t.running=false; cancelAnimationFrame(t._raf);
      document.getElementById(`timer-${id}`).textContent = fmt(t.elapsed);
    }

    // ======= Resposta do aluno =======
    function onAnswer(qid, letter){
      // inicia cronômetro no primeiro clique e para ao selecionar
      if(!timers[qid] || !timers[qid].running && !(qid in respostas)){
        startTimer(qid);
      }
      // Selecionou uma alternativa -> para timer e trava a questão
      stopTimer(qid);
      respostas[qid] = letter; // mantém o gabarito como no banco (letras originais)
      // Trava UI da questão
      const card = document.getElementById(`card-${qid}`);
      card.querySelectorAll('input[type="radio"]').forEach(inp=>{
        inp.disabled = true; if(inp.value===letter){ inp.checked=true; }
      });
      card.classList.add('locked');
      updateProgress();
    }

    function updateProgress(){
      const count = Object.keys(respostas).length;
      progressEl.textContent = `${count}/10 respondidas`;
      sendBtn.disabled = count<10 || !document.getElementById('student').value;
    }

    // ======= Envio ao Google Sheets =======
    async function enviar(){
      if(!SCRIPT_URL || SCRIPT_URL.includes('COLE_AQUI')){
        statusEl.innerHTML = '<span class="err">Configure a URL do Web App do Google Apps Script para enviar.</span>';
        return;
      }
      const alunoSel = document.getElementById('student');
      const alunoNome = alunoSel.value || '';
      const numero = document.getElementById('numero').value || '';
      const tempos = {};
      Object.keys(timers).forEach(id=>{ tempos[id] = timers[id].elapsed? Math.round(timers[id].elapsed/1000) : 0 });

      // Monta objeto de respostas em ordem das questões renderizadas
      const respostasOrdenadas = ordemQuestoes.map(id=> ({id, resposta: respostas[id]||''}));

      const payload = { aluno: alunoNome, numero, respostas: respostasOrdenadas, tempos, ordemQuestoes };
      try{
        statusEl.textContent = 'Enviando…';
        const res = await fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        const data = await res.json();
        if(data.ok){ statusEl.innerHTML = '<span class="ok">Enviado com sucesso!</span>'; }
        else{ statusEl.innerHTML = '<span class="err">Falha ao enviar: '+ (data.erro||'') +'</span>'; }
      }catch(err){
        statusEl.innerHTML = '<span class="err">Erro de rede: '+ String(err) +'</span>';
      }
    }

    // ======= Inicialização =======
    function initAlunos(){
      const sel = document.getElementById('student');
      sel.innerHTML = '<option value="">— selecione —</option>' + alunos.map(([num,nome])=>`<option value="${nome}">${nome}</option>`).join('');
      sel.addEventListener('change', ()=>{
        const nome = sel.value;
        const found = alunos.find((a)=>a[1]===nome);
        document.getElementById('numero').value = found? found[0] : '';
        updateProgress();
      });
    }

    document.getElementById('send').addEventListener('click', enviar);
    initAlunos();
    render();
  </script>
</body>
</html>
