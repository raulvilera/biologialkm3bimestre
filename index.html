<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atividade de Biologia - 3º Bimestre</title>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: silver; padding: 20px; color: #333;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    header {
      background: linear-gradient(to right, #0066cc, #000033);
      color: white; padding: 15px; border-radius: 10px;
      margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.3), 
      0 0 15px rgba(255,255,255,0.5) inset;
    }
    .school-name { text-align: center; font-size: 1.8em; font-weight: bold; margin-bottom: 15px; }
    .activity-title { text-align: center; font-size: 1.4em; margin-bottom: 15px; }
    
    .student-info {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, auto));
      gap: 10px; align-items: end;
    }
    .info-group label { font-weight: bold; margin-bottom: 4px; display: block; font-size: 0.9em; }
    .info-group select, .info-group input {
      padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px;
      width: auto; min-width: 160px; max-width: 100%;
    }

    .question {
      background: linear-gradient(to right, #0066cc, #000033);
      color: white; padding: 20px; border-radius: 10px;
      margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.3),
      0 0 15px rgba(255,255,255,0.5) inset;
    }
    .question-number { font-weight: bold; margin-bottom: 10px; font-size: 1.1em; }
    .question-text { margin-bottom: 12px; line-height: 1.5; }

    .alternatives { display: grid; gap: 8px; }
    .alternative {
      background: rgba(255,255,255,0.2); padding: 8px 12px;
      border-radius: 5px; display: flex; align-items: center;
      cursor: pointer; transition: background 0.3s;
      width: fit-content; max-width: 100%;
    }
    .alternative:hover { background: rgba(255,255,255,0.35); }
    .alternative-letter { font-weight: bold; margin-right: 6px; }
    .alternative input { margin-right: 8px; }
    .alternative-text { white-space: normal; }

    .buttons {
      display: flex; justify-content: center; gap: 20px; margin-top: 20px;
    }
    button {
      padding: 10px 20px; border: none; border-radius: 5px;
      background: linear-gradient(to bottom, #0066cc, #004499);
      color: white; cursor: pointer; font-weight: bold; transition: all .3s;
    }
    button:hover {
      background: linear-gradient(to bottom, #004499, #002266);
      transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .results {
      display: none; background: linear-gradient(to right, #0066cc, #000033);
      color: white; padding: 20px; border-radius: 10px;
      margin-top: 20px; text-align: center;
    }
    .score { font-size: 1.4em; margin-bottom: 12px; }
    .feedback { text-align: left; margin-top: 10px; }
    .feedback-item {
      margin-bottom: 8px; padding: 8px; border-radius: 5px;
      background: rgba(255,255,255,0.15);
    }
    .loading { display: none; text-align: center; margin-top: 20px; }
    .loading-spinner {
      border: 4px solid rgba(255,255,255,0.3); border-radius: 50%;
      border-top: 4px solid #0066cc; width: 30px; height: 30px;
      animation: spin 1s linear infinite; margin: 0 auto 8px;
    }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="school-name">E.E. LYDIAKITZ MOREIRA</div>
      <div class="activity-title">ATIVIDADE DE BIOLOGIA (3º BIMESTRE)<br>REVISÃO DOS TEMAS</div>
      
      <div class="student-info">
        <div class="info-group">
          <label for="student-name">NOME:</label>
          <select id="student-name">
            <option value="">Selecione seu nome</option>
          </select>
        </div>
        <div class="info-group">
          <label for="student-number">Nº:</label>
          <input type="text" id="student-number" readonly>
        </div>
        <div class="info-group">
          <label for="student-class">SÉRIE:</label>
          <input type="text" id="student-class" readonly>
        </div>
        <div class="info-group">
          <label for="activity-date">DATA:</label>
          <input type="text" id="activity-date" readonly>
        </div>
        <div class="info-group">
          <label for="student-email">E-mail institucional:</label>
          <input type="text" id="student-email" readonly>
        </div>
      </div>
    </header>

    <div id="questions-container"></div>

    <div class="buttons">
      <button id="submit-btn">Enviar Respostas</button>
      <button id="reset-btn">Limpar Tudo</button>
    </div>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>Enviando respostas para o Google Sheets...</p>
    </div>

    <div id="results" class="results">
      <div class="score">Sua pontuação: <span id="score-value">0</span>/10</div>
      <div>Obrigado por participar! Suas respostas foram registradas.</div>
      <div class="feedback" id="feedback"></div>
    </div>
  </div>

  <script>
    const students = [
      {number: 1, name: "ALEXANDRE BATISTA DOS SANTOS", email: "00001141439785SP@al.educacao.sp.gov.br"},
      {number: 5, name: "ANA LÍVIA BRAGA DOS SANTOS", email: "00001122248246SP@al.educacao.sp.gov.br"}
      // (...adicione os outros nomes)
    ];

    const questions = [
      {
        id: 1,
        question: "No Jogo dos Quatis, ... qual foi o impacto?",
        alternatives: [
          "Aumento de 1 indivíduo...", 
          "Diminuição de 1 indivíduo...", 
          "Aumento de 6 indivíduos...",
          "Diminuição de 3 indivíduos...",
          "Não houve alteração..."
        ],
        correct: 0,
        feedback: "O aumento na população de sapos representa..."
      }
      // (...adicione as outras questões)
    ];

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxfQZqBIhFhIVqho2vpreBaYEgL43Hka2E9-5qiPiAiy_seEXNeDaKe5Z8xrkgrTJ60/exec";

    let selectedQuestions = [];
    let studentAnswers = {};
    let currentStudent = null;

    function initActivity() {
      document.getElementById('activity-date').value = new Date().toLocaleDateString('pt-BR');
      const studentSelect = document.getElementById('student-name');
      students.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.number; opt.textContent = s.name;
        studentSelect.appendChild(opt);
      });
      selectedQuestions = getRandomQuestions(questions, 10);
      displayQuestions(selectedQuestions);
      document.getElementById('student-name').addEventListener('change', handleStudentSelection);
      document.getElementById('submit-btn').addEventListener('click', handleSubmit);
      document.getElementById('reset-btn').addEventListener('click', () => location.reload());
    }

    function getRandomQuestions(arr, count) {
      return [...arr].sort(() => Math.random() - 0.5).slice(0, count);
    }

    function displayQuestions(qs) {
      const container = document.getElementById('questions-container');
      container.innerHTML = "";
      qs.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = "question";
        div.innerHTML = `
          <div class="question-number">Questão ${i+1}:</div>
          <div class="question-text">${q.question}</div>
          <div class="alternatives">
            ${q.alternatives.map((alt, j) => `
              <label class="alternative">
                <span class="alternative-letter">${String.fromCharCode(65+j)})</span>
                <input type="radio" name="q-${q.id}" value="${j}">
                <span class="alternative-text">${alt}</span>
              </label>
            `).join('')}
          </div>
        `;
        container.appendChild(div);
      });
    }

    function handleStudentSelection(e) {
      const student = students.find(s => s.number == e.target.value);
      if (student) {
        currentStudent = student;
        document.getElementById('student-number').value = student.number;
        document.getElementById('student-class').value = "1ª Série";
        document.getElementById('student-email').value = student.email;
      }
    }

    async function handleSubmit() {
      if (!currentStudent) { alert("Selecione seu nome."); return; }
      studentAnswers = {};
      let allAnswered = true;
      selectedQuestions.forEach(q => {
        const selected = document.querySelector(`input[name="q-${q.id}"]:checked`);
        if (selected) studentAnswers[q.id] = parseInt(selected.value);
        else allAnswered = false;
      });
      if (!allAnswered) { alert("Responda todas as questões."); return; }
      const score = calculateScore(selectedQuestions, studentAnswers);
      document.getElementById('loading').style.display = 'block';
      try {
        await sendDataToGoogleSheets(score);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('score-value').textContent = score;
        document.getElementById('results').style.display = 'block';
        generateFeedback(selectedQuestions, studentAnswers);
        document.getElementById('results').scrollIntoView({behavior:"smooth"});
      } catch (err) {
        console.error(err);
        document.getElementById('loading').style.display = 'none';
        alert("Erro ao enviar respostas. Por favor, tente novamente.");
      }
    }

    function calculateScore(qs, answers) {
      return qs.reduce((acc, q) => acc + (answers[q.id] === q.correct ? 1 : 0), 0);
    }

    function generateFeedback(qs, answers) {
      const fb = document.getElementById('feedback');
      fb.innerHTML = "";
      qs.forEach((q, i) => {
        if (answers[q.id] !== q.correct) {
          const div = document.createElement('div');
          div.className = "feedback-item";
          div.innerHTML = `<strong>Questão ${i+1}:</strong> ${q.feedback}`;
          fb.appendChild(div);
        }
      });
      if (!fb.innerHTML) fb.innerHTML = `<div class="feedback-item">Parabéns! Você acertou tudo!</div>`;
    }

    async function sendDataToGoogleSheets(score) {
      const payload = {
        student: currentStudent,
        answers: studentAnswers,
        score: score,
        date: new Date().toLocaleString("pt-BR")
      };
      const res = await fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      });
      return res;
    }

    window.onload = initActivity;
  </script>
</body>
</html>
